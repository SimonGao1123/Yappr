import{r as x,j as e}from"./index-CZZQt8Co.js";import{c as _,r as w,a as I,s as O}from"./FriendsFunctions-MZtW1pYR.js";import{a as v,d as C,b as T,c as A}from"./MessageFunctions-DUnXJg01.js";function H({currentUser:a,ifLightMode:n,currentFriends:s,outgoingFriendReq:c,incomingFriendReq:t}){const[l,d]=x.useState(0),[u,r]=x.useState(null),[p,o]=x.useState(null),[i,m]=x.useState(null);return x.useEffect(()=>{if(!a?.id)return;f(a.id,d,r,o,m);const j=setInterval(()=>{f(a.id,d,r,o,m)},1500);return()=>{clearInterval(j),fetch("/api/randomChats/leaveQueue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:a.id})}).catch(h=>console.log(h))}},[a?.id]),e.jsx(e.Fragment,{children:l==0?e.jsx(D,{currentUser:a,setStatus:d,ifLightMode:n}):l==1?e.jsx(F,{currentUser:a,queueSize:i,setStatus:d,setCurrChatData:r,setMessageData:o,ifLightMode:n}):l==2?e.jsx(Q,{currentUser:a,chatData:u,messageData:p,setStatus:d,setCurrChatData:r,setMessageData:o,ifLightMode:n,setQueueSize:m,currentFriends:s,outgoingFriendReq:c,incomingFriendReq:t}):e.jsx("p",{children:"INVALID STATUS ERROR"})})}function D({currentUser:a,setStatus:n,ifLightMode:s}){return e.jsx("div",{className:`rcp-join-queue-screen${s?"":" dark-mode"}`,children:e.jsxs("div",{className:`rcp-queue-card${s?"":" dark-mode"}`,children:[e.jsx("div",{className:"rcp-queue-icon",children:"ðŸŽ²"}),e.jsx("h3",{className:`rcp-queue-title${s?"":" dark-mode"}`,children:"Random Yapp"}),e.jsx("p",{className:`rcp-queue-subtitle${s?"":" dark-mode"}`,children:"Meet new people! Join the queue to be matched with a random user for a chat."}),e.jsx("button",{className:"rcp-join-queue-btn",onClick:()=>z(a.id,n),children:"Join Queue"})]})})}function F({currentUser:a,queueSize:n,setStatus:s,setCurrChatData:c,setMessageData:t,ifLightMode:l}){return e.jsx("div",{className:`rcp-waiting-screen${l?"":" dark-mode"}`,children:e.jsxs("div",{className:`rcp-waiting-card${l?"":" dark-mode"}`,children:[e.jsx("div",{className:`rcp-waiting-spinner${l?"":" dark-mode"}`}),e.jsx("h3",{className:`rcp-waiting-title${l?"":" dark-mode"}`,children:"Looking for a Match..."}),e.jsx("p",{className:`rcp-waiting-subtitle${l?"":" dark-mode"}`,children:"Hang tight! We're finding someone to chat with."}),e.jsxs("div",{className:`rcp-queue-count${l?"":" dark-mode"}`,children:[e.jsx("span",{className:"rcp-queue-count-icon",children:"ðŸ‘¥"}),e.jsx("p",{className:`rcp-queue-count-text${l?"":" dark-mode"}`,children:n?`${n} people in queue`:"Loading..."})]}),e.jsx("button",{className:"rcp-leave-queue-btn",onClick:()=>q(a.id,s,c,t),children:"Leave Queue"}),e.jsx("p",{className:`rcp-waiting-tip${l?"":" dark-mode"}`,children:"ðŸ’¡ You'll be matched automatically when another user joins!"})]})})}function Q({currentUser:a,chatData:n,messageData:s,setStatus:c,setCurrChatData:t,setMessageData:l,ifLightMode:d,setQueueSize:u,currentFriends:r,outgoingFriendReq:p,incomingFriendReq:o}){let i=0;if(n){const{userData:m}=n;i=m[0]?.user_id==a.id?m[1]?.user_id:m[0]?.user_id}return e.jsxs("div",{className:`rcp-random-chat-layout${d?"":" dark-mode"}`,children:[" ",e.jsxs("div",{className:`rcp-random-chat-center-col${d?"":" dark-mode"}`,children:[e.jsxs("div",{className:`rcp-random-chat-controls${d?"":" dark-mode"}`,children:[e.jsx("button",{className:"rcp-next-chat-btn",onClick:()=>{n&&Z(n.chat_id,i??0,a.id,c,t,l)},children:"Next"}),e.jsx("button",{className:"rcp-leave-chat-btn",onClick:()=>n&&q(a.id,c,t,l),children:"Leave RandomYapp"})]}),n&&e.jsx(J,{currentUser:a,chat_id:n.chat_id,ifLightMode:d,messageData:s,setMessageData:l,setCurrChatData:t,setStatus:c,setQueueSize:u})]}),e.jsx("div",{className:`rcp-random-chat-users-col${d?"":" dark-mode"}`,children:n&&e.jsx(P,{userData:n.userData,currentUser:a,ifLightMode:d,currentFriends:r,outgoingFriendReq:p,incomingFriendReq:o})})]})}function E({currentUser:a,chat_id:n,ifLightMode:s,setMessageData:c,setCurrChatData:t,setStatus:l,setQueueSize:d}){const[u,r]=x.useState(""),[p,o]=x.useState(!1);return e.jsxs("div",{id:"send-msg-input",className:s?"":"dark-mode",children:[e.jsx("input",{id:"message-send-bar",className:s?"":"dark-mode",placeholder:"Send Message",type:"text",value:u,onChange:i=>r(i.target.value)}),e.jsx("button",{id:"send-msg-btn",className:s?"":"dark-mode",onClick:()=>{p?A(r,o,u,n,a.id,a.username):T(n,u,a.id,r,c,t,l,d)},children:"Send"}),e.jsxs("div",{className:`gemini-checkbox-wrapper${s?"":" dark-mode"}`,children:[e.jsxs("label",{htmlFor:"if-ask-gemini",children:[e.jsx("img",{src:v,alt:"gemini-logo",className:"gemini-logo"})," Ask Gemini"]}),e.jsx("input",{id:"if-ask-gemini",className:s?"":"dark-mode",checked:p,onChange:()=>o(!p),type:"checkbox"})]})]})}function J({currentUser:a,chat_id:n,ifLightMode:s,messageData:c,setMessageData:t,setCurrChatData:l,setStatus:d,setQueueSize:u}){const r=[];if(console.log(c),c!==null)for(const p of c){const{message_id:o,sender_id:i,message:m,username:j,sent_at:h,askGemini:y}=p;i!==-1&&y===1?r.push(e.jsxs("li",{className:`msg-container ${i===a.id?"your-msg":""} ${s?"":"dark-mode"}`,children:[e.jsxs("p",{className:`msg-username-date ${s?"":"dark-mode"}`,children:[j," ",$(h)]}),e.jsx("p",{className:`msg-text ${s?"":"dark-mode"}`,children:m}),e.jsxs("div",{className:`gemini-text ${s?"":"dark-mode"}`,children:[e.jsx("span",{children:"Ask Gemini"}),e.jsx("img",{src:v,alt:"gemini-logo",className:"gemini-logo"})]}),i===a.id?e.jsx("button",{onClick:()=>C(o,a.id,i,n),className:`delete-msg-btn ${s?"":"dark-mode"}`,children:"Delete"}):e.jsx(e.Fragment,{})]},o)):i===-1&&y===1?r.push(e.jsxs("li",{className:`ai-response-container ${s?"":"dark-mode"}`,children:[e.jsx("img",{src:v,alt:"gemini-logo",className:"gemini-logo"}),e.jsx("p",{className:`msg-text ${s?"":"dark-mode"}`,children:m}),e.jsx("p",{className:`msg-time ${s?"":"dark-mode"}`,children:$(h)})]},o)):i===-1?r.push(e.jsx("li",{className:`server-msg-container ${s?"":"dark-mode"}`,children:e.jsxs("p",{className:`msg-text ${s?"":"dark-mode"}`,children:[m," ",$(h)]})},o)):r.push(e.jsxs("li",{className:`msg-container ${i===a.id?"your-msg":""} ${s?"":"dark-mode"}`,children:[e.jsxs("p",{className:`msg-username-date ${s?"":"dark-mode"}`,children:[j," ",$(h)]}),e.jsx("p",{className:`msg-text ${s?"":"dark-mode"}`,children:m}),i===a.id?e.jsx("button",{onClick:()=>C(o,a.id,i,n),className:`delete-msg-btn ${s?"":"dark-mode"}`,children:"Delete"}):e.jsx(e.Fragment,{})]},o))}return e.jsxs(e.Fragment,{children:[e.jsx("ul",{id:"msg-display",className:s?"":"dark-mode",children:r}),e.jsx(E,{currentUser:a,chat_id:n,ifLightMode:s,setMessageData:t,setCurrChatData:l,setStatus:d,setQueueSize:u})]})}function P({userData:a,currentUser:n,ifLightMode:s,currentFriends:c,outgoingFriendReq:t,incomingFriendReq:l}){const d=[],[u,r]=x.useState(null);let p=null;for(const o of a){const{user_id:i,username:m,account_created:j,description:h,updated_at:y}=o;let k,N="";const R=c.find(g=>g.user_id===i),S=t.find(g=>g.user_id===i),b=l.find(g=>g.user_id===i);i!==n.id&&(R?(k=" ðŸ‘¥",N="Friends"):S?(k=e.jsx("button",{className:`cancel-req-btn ${s?"":"dark-mode"}`,onClick:()=>_(S.friend_id,i,m??""),children:" Cancel "}),N=" Outgoing Request"):b?(k=e.jsxs("div",{className:"chat-incoming-req-btns",children:[e.jsx("button",{className:`reject-req-btn ${s?"":"dark-mode"}`,onClick:()=>w(b.friend_id,m??"",i),children:" Reject "}),e.jsx("button",{className:`accept-req-btn ${s?"":"dark-mode"}`,onClick:()=>I(b.friend_id,m??"",i),children:" Accept "})]}),N=" Incoming Request"):k=e.jsx("button",{className:`send-friend-req-btn ${s?"":"dark-mode"}`,onClick:()=>O(n.id,i),children:"Send Request"})),u===i&&(p=e.jsx(Y,{user:o,setUserDetailsOpen:r,currentUser:n,ifLightMode:s,friendBtns:k,descFriends:N},`popup-${i}`)),d.push(e.jsxs("li",{className:`chat-user-list ${s?"":"dark-mode"}`,onClick:()=>{r(i)},children:[m,n.id===i?"(You)":"",e.jsx("p",{className:`desc-friends ${s?"":"dark-mode"}`,children:N})]},`random-${i}`))}return e.jsxs("div",{style:{position:"relative",zIndex:1e3},children:[e.jsx("h3",{className:`rcp-users-header${s?"":" dark-mode"}`,children:"Users in Chat"}),e.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:d}),p]})}function Y({user:a,setUserDetailsOpen:n,currentUser:s,ifLightMode:c,friendBtns:t,descFriends:l}){const{friend_id:d,user_id:u,status:r,username:p,account_created:o,description:i,updated_at:m}=a;return e.jsx(e.Fragment,{children:e.jsxs("div",{id:"display-user-details",className:c?"":"dark-mode",onClick:j=>j.stopPropagation(),children:[e.jsx("button",{id:"close-user-details",className:c?"":"dark-mode",onClick:j=>{n(null)},children:"X"}),e.jsxs("h3",{id:"display-user-username",className:c?"":"dark-mode",children:[e.jsx("b",{children:p})," ID: ",u," ",t]}),e.jsxs("p",{id:"creation-date",className:c?"":"dark-mode",children:["Account created at: ",o]}),s.id!==u?e.jsxs("p",{id:"friends-since",className:c?"":"dark-mode",children:[l," ",m?`Since ${m}`:""]}):e.jsx(e.Fragment,{}),e.jsxs("p",{id:"display-user-description",className:c?"":"dark-mode",children:["Description: ",i||"None added"]})]})})}function Z(a,n,s,c,t,l){fetch("/api/randomChats/leaveRandomChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:a,user_id:s,other_user_id:n})}).then(async d=>{const u=await d.json();u.success&&(c(1),t(null),l(null)),console.log(u.message)}).catch(d=>{console.log(d)})}function q(a,n,s,c){fetch("/api/randomChats/leaveQueue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:a})}).then(async t=>{const l=await t.json();l.success&&(n(0),s(null),c(null)),console.log(l.message)}).catch(t=>{console.log(t)})}function z(a,n){fetch("/api/randomChats/joinQueue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:a})}).then(async s=>{const c=await s.json();console.log(c.message),c.success&&n(1)}).catch(s=>{console.log(s)})}function f(a,n,s,c,t){fetch(`/api/randomChats/getRandomChat/${a}`).then(async l=>{const d=await l.json();if(!d.success){console.log(d.message);return}d.waiting==!1&&d.inChat==!1?(n(0),s(null),c(null)):d.waiting==!0&&d.inChat==!1?(n(1),s(null),c(null),t(d.queueSize??null)):d.inChat==!0&&(n(2),s(d.chatData??null),c(d.messages??null))}).catch(l=>{console.log(l)})}function $(a){const n=new Date(a),s=new Date,c=n.getFullYear()===s.getFullYear()&&n.getMonth()===s.getMonth()&&n.getDate()===s.getDate(),t=Intl.DateTimeFormat().resolvedOptions().timeZone,l={month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0,timeZone:t};return c?n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0,timeZone:t}):n.toLocaleString("en-US",l)}export{H as default};
