import{r as x,j as e}from"./index-B_id87nB.js";import{c as S,r as $,a as v,s as R}from"./FriendsFunctions-DXfdf5lc.js";import{a as f,d as y,b as _,c as q}from"./MessageFunctions-DUnXJg01.js";function G({currentUser:a,ifLightMode:n}){const[s,l]=x.useState(0),[d,c]=x.useState(null),[i,o]=x.useState(null),[r,t]=x.useState(null);return x.useEffect(()=>{if(!a?.id)return;b(a.id,l,c,o,t);const u=setInterval(()=>{b(a.id,l,c,o,t)},1500);return()=>clearInterval(u)},[a?.id]),e.jsx(e.Fragment,{children:s==0?e.jsx(F,{currentUser:a,setStatus:l,ifLightMode:n}):s==1?e.jsx(A,{currentUser:a,queueSize:r,setStatus:l,setCurrChatData:c,setMessageData:o,ifLightMode:n}):s==2?e.jsx(I,{currentUser:a,chatData:d,messageData:i,setStatus:l,setCurrChatData:c,setMessageData:o,ifLightMode:n,setQueueSize:t}):e.jsx("p",{children:"INVALID STATUS ERROR"})})}function F({currentUser:a,setStatus:n,ifLightMode:s}){return e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Currently not in Queue"}),e.jsx("button",{onClick:()=>E(a.id,n),children:"Join Queue"})]})}function A({currentUser:a,queueSize:n,setStatus:s,setCurrChatData:l,setMessageData:d}){return e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Currently waiting in Queue"}),e.jsxs("p",{children:["There are: ",n||"Loading..."," people in queue"]}),e.jsx("button",{onClick:()=>C(a.id,s,l,d),children:"Leave Queue"})]})}function I({currentUser:a,chatData:n,messageData:s,setStatus:l,setCurrChatData:d,setMessageData:c,ifLightMode:i,setQueueSize:o}){let r=0;if(n){const{userData:t}=n;r=t[0]?.user_id==a.id?t[1]?.user_id:t[0]?.user_id}return e.jsxs("div",{className:`rcp-random-chat-layout${i?"":" dark-mode"}`,children:[" ",e.jsxs("div",{className:"rcp-random-chat-center-col",children:[e.jsxs("div",{className:"rcp-random-chat-controls",children:[e.jsx("button",{className:"rcp-next-chat-btn",onClick:()=>{n&&T(n.chat_id,r??0,a.id,l,d,c)},children:"Next"}),e.jsx("button",{className:"rcp-leave-chat-btn",onClick:()=>n&&C(a.id,l,d,c),children:"Leave RandomYapp"})]}),n&&e.jsx(D,{currentUser:a,chat_id:n.chat_id,ifLightMode:i,messageData:s,setMessageData:c,setCurrChatData:d,setStatus:l,setQueueSize:o})]}),e.jsx("div",{className:"rcp-random-chat-users-col",children:n&&e.jsx(O,{userData:n.userData,currentUser:a,ifLightMode:i})})]})}function w({currentUser:a,chat_id:n,ifLightMode:s,setMessageData:l,setCurrChatData:d,setStatus:c,setQueueSize:i}){const[o,r]=x.useState(""),[t,u]=x.useState(!1);return e.jsxs("div",{id:"send-msg-input",className:s?"":"dark-mode",children:[e.jsx("input",{id:"message-send-bar",className:s?"":"dark-mode",placeholder:"Send Message",type:"text",value:o,onChange:m=>r(m.target.value)}),e.jsx("button",{id:"send-msg-btn",className:s?"":"dark-mode",onClick:()=>{t?q(r,u,o,n,a.id,a.username):_(n,o,a.id,r,l,d,c,i)},children:"Send"}),e.jsxs("div",{className:"gemini-checkbox-wrapper",children:[e.jsxs("label",{htmlFor:"if-ask-gemini",children:[e.jsx("img",{src:f,alt:"gemini-logo",className:"gemini-logo"})," Ask Gemini"]}),e.jsx("input",{id:"if-ask-gemini",className:s?"":"dark-mode",checked:t,onChange:()=>u(!t),type:"checkbox"})]})]})}function D({currentUser:a,chat_id:n,ifLightMode:s,messageData:l,setMessageData:d,setCurrChatData:c,setStatus:i,setQueueSize:o}){const r=[];if(console.log(l),l!==null)for(const t of l){const{message_id:u,sender_id:m,message:p,username:h,sent_at:g,askGemini:j}=t;m!==-1&&j===1?r.push(e.jsxs("li",{className:`msg-container ${m===a.id?"your-msg":""} ${s?"":"dark-mode"}`,children:[e.jsxs("p",{className:`msg-username-date ${s?"":"dark-mode"}`,children:[h," ",N(g)]}),e.jsx("p",{className:`msg-text ${s?"":"dark-mode"}`,children:p}),e.jsxs("div",{className:`gemini-text ${s?"":"dark-mode"}`,children:[e.jsx("span",{children:"Ask Gemini"}),e.jsx("img",{src:f,alt:"gemini-logo",className:"gemini-logo"})]}),m===a.id?e.jsx("button",{onClick:()=>y(u,a.id,m,n),className:`delete-msg-btn ${s?"":"dark-mode"}`,children:"Delete"}):e.jsx(e.Fragment,{})]},u)):m===-1&&j===1?r.push(e.jsxs("li",{className:`ai-response-container ${s?"":"dark-mode"}`,children:[e.jsx("img",{src:f,alt:"gemini-logo",className:"gemini-logo"}),e.jsx("p",{className:`msg-text ${s?"":"dark-mode"}`,children:p}),e.jsx("p",{className:`msg-time ${s?"":"dark-mode"}`,children:N(g)})]},u)):m===-1?r.push(e.jsx("li",{className:"server-msg-container",children:e.jsxs("p",{className:`msg-text ${s?"":"dark-mode"}`,children:[p," ",N(g)]})},u)):r.push(e.jsxs("li",{className:`msg-container ${m===a.id?"your-msg":""} ${s?"":"dark-mode"}`,children:[e.jsxs("p",{className:`msg-username-date ${s?"":"dark-mode"}`,children:[h," ",N(g)]}),e.jsx("p",{className:`msg-text ${s?"":"dark-mode"}`,children:p}),m===a.id?e.jsx("button",{onClick:()=>y(u,a.id,m,n),className:`delete-msg-btn ${s?"":"dark-mode"}`,children:"Delete"}):e.jsx(e.Fragment,{})]},u))}return e.jsxs(e.Fragment,{children:[e.jsx("ul",{id:"msg-display",className:s?"":"dark-mode",children:r}),e.jsx(w,{currentUser:a,chat_id:n,ifLightMode:s,setMessageData:d,setCurrChatData:c,setStatus:i,setQueueSize:o})]})}function O({userData:a,currentUser:n,ifLightMode:s}){const l=[],[d,c]=x.useState(null);let i=null;for(const o of a){const{friend_id:r,user_id:t,status:u,username:m,account_created:p,description:h,updated_at:g}=o;let j,k="";t!==n.id&&(u==="friends"?(j=" ðŸ‘¥",k="Friends"):u==="outgoing"?(j=e.jsx("button",{className:`cancel-req-btn ${s?"":"dark-mode"}`,onClick:()=>S(r??0,t,m??""),children:" Cancel "}),k=" Outgoing Request"):u==="incoming"?(j=e.jsxs("div",{className:"chat-incoming-req-btns",children:[e.jsx("button",{className:`reject-req-btn ${s?"":"dark-mode"}`,onClick:()=>$(r??0,m??"",t),children:" Reject "}),e.jsx("button",{className:`accept-req-btn ${s?"":"dark-mode"}`,onClick:()=>v(r??0,m??"",t),children:" Accept "})]}),k=" Incoming Request"):j=e.jsx("button",{className:`send-friend-req-btn ${s?"":"dark-mode"}`,onClick:()=>R(n.id,t),children:"Send Request"})),d===t&&(i=e.jsx(Q,{user:o,setUserDetailsOpen:c,currentUser:n,ifLightMode:s,friendBtns:j,descFriends:k},`popup-${t}`)),l.push(e.jsxs("li",{className:"chat-user-list",onClick:()=>{c(t)},children:[m,n.id===t?"(You)":"",e.jsx("p",{className:`desc-friends ${s?"":"dark-mode"}`,children:k})]},`random-${t}`))}return e.jsxs("div",{style:{position:"relative"},children:[e.jsx("ul",{children:l}),i]})}function Q({user:a,setUserDetailsOpen:n,currentUser:s,ifLightMode:l,friendBtns:d,descFriends:c}){const{friend_id:i,user_id:o,status:r,username:t,account_created:u,description:m,updated_at:p}=a;return e.jsx(e.Fragment,{children:e.jsxs("div",{id:"display-user-details",className:l?"":"dark-mode",onClick:h=>h.stopPropagation(),children:[e.jsx("button",{id:"close-user-details",className:l?"":"dark-mode",onClick:h=>{n(null)},children:"X"}),e.jsxs("h3",{id:"display-user-username",className:l?"":"dark-mode",children:[e.jsx("b",{children:t})," ID: ",o," ",d]}),e.jsxs("p",{id:"creation-date",className:l?"":"dark-mode",children:["Account created at: ",u]}),s.id!==o?e.jsxs("p",{id:"friends-since",className:l?"":"dark-mode",children:[c," ",p?`Since ${p}`:""]}):e.jsx(e.Fragment,{}),e.jsxs("p",{id:"display-user-description",className:l?"":"dark-mode",children:["Description: ",m||"None added"]})]})})}function T(a,n,s,l,d,c){fetch("/api/randomChats/leaveRandomChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:a,user_id:s,other_user_id:n})}).then(async i=>{const o=await i.json();o.success&&(l(1),d(null),c(null)),console.log(o.message)}).catch(i=>{console.log(i)})}function C(a,n,s,l){fetch("/api/randomChats/leaveQueue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:a})}).then(async d=>{const c=await d.json();c.success&&(n(0),s(null),l(null)),console.log(c.message)}).catch(d=>{console.log(d)})}function E(a,n){fetch("/api/randomChats/joinQueue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:a})}).then(async s=>{const l=await s.json();console.log(l.message),l.success&&n(1)}).catch(s=>{console.log(s)})}function b(a,n,s,l,d){fetch(`/api/randomChats/getRandomChat/${a}`).then(async c=>{const i=await c.json();if(!i.success){console.log(i.message);return}i.waiting==!1&&i.inChat==!1?(n(0),s(null),l(null)):i.waiting==!0&&i.inChat==!1?(n(1),s(null),l(null),d(i.queueSize??null)):i.inChat==!0&&(n(2),s(i.chatData??null),l(i.messages??null))}).catch(c=>{console.log(c)})}function N(a){const n=new Date(a),s=new Date,l=n.getFullYear()===s.getFullYear()&&n.getMonth()===s.getMonth()&&n.getDate()===s.getDate(),d={month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0};return l?n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):n.toLocaleString("en-US",d)}export{G as default};
