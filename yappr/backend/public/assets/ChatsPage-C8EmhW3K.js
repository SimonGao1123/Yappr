import{r as j,j as e}from"./index-B_id87nB.js";import{g as w,a as _,d as $,s as D,p as T}from"./MessageFunctions-DUnXJg01.js";import{c as O,r as P,a as I,s as q}from"./FriendsFunctions-DXfdf5lc.js";function A({currentUser:o,chat_id:n,ifLightMode:s}){const[a,t]=j.useState([]);return j.useEffect(()=>{if(!o?.id)return;w(o.id,t,n);const i=setInterval(()=>{w(o.id,t,n)},2e3);return()=>clearInterval(i)},[o?.id,n]),e.jsxs(e.Fragment,{children:[e.jsx(E,{pastMessageData:a,currentUser:o,chat_id:n,ifLightMode:s}),e.jsx(R,{currentUser:o,chat_id:n,ifLightMode:s,setMessageData:t})]})}const E=j.memo(function({pastMessageData:n,currentUser:s,chat_id:a,ifLightMode:t}){const i=j.useMemo(()=>{const c=[];for(const l of n){const{message_id:r,sender_id:m,message:d,username:p,sent_at:u,askGemini:g}=l;m!==-1&&g===1?c.push(e.jsxs("li",{className:`msg-container ${m===s.id?"your-msg":""} ${t?"":"dark-mode"}`,children:[e.jsxs("p",{className:`msg-username-date ${t?"":"dark-mode"}`,children:[p," ",f(u)]}),e.jsx("p",{className:`msg-text ${t?"":"dark-mode"}`,children:d}),e.jsxs("div",{className:`gemini-text ${t?"":"dark-mode"}`,children:[e.jsx("span",{children:"Ask Gemini"}),e.jsx("img",{src:_,alt:"gemini-logo",className:"gemini-logo"})]}),m===s.id?e.jsx("button",{onClick:()=>$(r,s.id,m,a),className:`delete-msg-btn ${t?"":"dark-mode"}`,children:"Delete"}):e.jsx(e.Fragment,{})]},r)):m===-1&&g===1?c.push(e.jsxs("li",{className:`ai-response-container ${t?"":"dark-mode"}`,children:[e.jsx("img",{src:_,alt:"gemini-logo",className:"gemini-logo"}),e.jsx("p",{className:`msg-text ${t?"":"dark-mode"}`,children:d}),e.jsx("p",{className:`msg-time ${t?"":"dark-mode"}`,children:f(u)})]},r)):m===-1?c.push(e.jsx("li",{className:"server-msg-container",children:e.jsxs("p",{className:`msg-text ${t?"":"dark-mode"}`,children:[d," ",f(u)]})},r)):c.push(e.jsxs("li",{className:`msg-container ${m===s.id?"your-msg":""} ${t?"":"dark-mode"}`,children:[e.jsxs("p",{className:`msg-username-date ${t?"":"dark-mode"}`,children:[p," ",f(u)]}),e.jsx("p",{className:`msg-text ${t?"":"dark-mode"}`,children:d}),m===s.id?e.jsx("button",{onClick:()=>$(r,s.id,m,a),className:`delete-msg-btn ${t?"":"dark-mode"}`,children:"Delete"}):e.jsx(e.Fragment,{})]},r))}return c},[n,s.id,a,t]);return e.jsx("ul",{id:"msg-display",className:t?"":"dark-mode",children:i})});function R({currentUser:o,chat_id:n,ifLightMode:s,setMessageData:a}){const[t,i]=j.useState(""),[c,l]=j.useState(!1);return e.jsxs("div",{id:"send-msg-input",className:s?"":"dark-mode",children:[e.jsx("input",{id:"message-send-bar",className:s?"":"dark-mode",placeholder:"Send Message",type:"text",value:t,onChange:r=>i(r.target.value)}),e.jsx("button",{id:"send-msg-btn",className:s?"":"dark-mode",onClick:()=>{c?T(i,l,t,n,o.id,o.username,a):D(n,t,o.id,i,a)},children:"Send"}),e.jsxs("div",{className:"gemini-checkbox-wrapper",children:[e.jsxs("label",{htmlFor:"if-ask-gemini",children:[e.jsx("img",{src:_,alt:"gemini-logo",className:"gemini-logo"})," Ask Gemini"]}),e.jsx("input",{id:"if-ask-gemini",className:s?"":"dark-mode",checked:c,onChange:()=>l(!c),type:"checkbox"})]})]})}function f(o){const n=new Date(o),s=new Date,a=n.getFullYear()===s.getFullYear()&&n.getMonth()===s.getMonth()&&n.getDate()===s.getDate(),t={month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0};return a?n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):n.toLocaleString("en-US",t)}const J="/assets/leaveChatIcon-VdSxEAUK.png",Y="/assets/edit-chat-name-icon-DvX9AU5r.png",B="/assets/update-chat-name-icon-TTeh5gq5.png";async function X(o,n,s,a,t){if(t(!1),s.length===0){console.log("No friends selected");return}try{const c=await(await fetch("/api/chats/addToChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:o,user_id:n,addedFriends:s,chat_id:a})})).json();console.log(c.message)}catch(i){console.log(i)}}async function G(o,n,s,a,t,i){try{const l=await(await fetch("/api/chats/kick",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({creator_id:o,user_id:n,user_username:s,kicked_id:a,kicked_username:t,chat_id:i})})).json();console.log(l.message)}catch(c){console.log(c)}}function K(o,n){fetch("/api/message/readMessages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:o,user_id:n})}).then(async s=>{const a=await s.json();console.log(a.message)}).catch(s=>{console.log(s)})}async function z(o,n,s){try{const t=await(await fetch("/api/chats/deleteChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:o,chat_id:n,creator_id:s})})).json();console.log(t.message)}catch(a){console.log(a)}}async function H(o,n,s,a){try{const i=await(await fetch("/api/chats/leaveChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:o,username:n,chat_id:s,creator_id:a})})).json();console.log(i.message)}catch(t){console.log(t)}}function ne({currentUser:o,currentFriends:n,ifLightMode:s,allChats:a,setAllChats:t}){const[i,c]=j.useState(!1),[l,r]=j.useState(!1),[m,d]=j.useState("chats"),p=async()=>{try{const g=await(await fetch(`/api/chats/displayChats/${o.id}`)).json();g.success&&g.chat_data&&t(g.chat_data)}catch(u){console.log("Error refreshing chats:",u)}};return e.jsxs(e.Fragment,{children:[i?e.jsx(L,{currentFriends:n,currentUser:o,setCreateChatsDisplay:c,ifLightMode:s,refreshChats:p}):e.jsx(e.Fragment,{}),e.jsx(Q,{setCreateChatsDisplay:c,addMembersDisplay:l,setAddMembersDisplay:r,currentUser:o,allChats:a,currentFriends:n,ifLightMode:s,mobileView:m,setMobileView:d,refreshChats:p})]})}function Q({setCreateChatsDisplay:o,addMembersDisplay:n,setAddMembersDisplay:s,currentUser:a,allChats:t,currentFriends:i,ifLightMode:c,mobileView:l,setMobileView:r,refreshChats:m}){const[d,p]=j.useState(null),[u,g]=j.useState("");j.useEffect(()=>{if(!d)return;const h=t.find(N=>N.chat_id===d.chat_id);h?p(h):(p(null),r("chats"))},[t]),j.useEffect(()=>{d&&d.unread&&K(d.chat_id,a.id)},[d]),j.useEffect(()=>{m()},[d?.chat_id]);const x=h=>{p(h),r("messages")},k=[];for(const h of t.filter(N=>N.chat_name.toLowerCase().includes(u.toLowerCase()))||[]){const{chat_name:N}=h;k.push(e.jsxs("li",{onClick:()=>x(h),className:`chat ${d?.chat_id===h.chat_id?"selected-chat":""} ${c?"":"dark-mode"}`,children:[e.jsxs("p",{className:"chat-name-sec",children:[N," ",h.unread?"ðŸ”´ unread messages":""]}),e.jsxs("div",{className:"chat-button-container",children:[h.creator_id===a.id?e.jsx("button",{id:"delete-chat-btn",className:c?"":"dark-mode",onClick:async C=>{C.stopPropagation(),await z(a.id,h.chat_id,h.creator_id),await m(),h.chat_id===d?.chat_id&&(p(null),r("chats")),s(!1)},children:"Delete"}):e.jsx(e.Fragment,{}),e.jsx("button",{id:"leave-btn",className:c?"":"dark-mode",onClick:async C=>{C.stopPropagation(),await H(a.id,a.username,h.chat_id,h.creator_id),await m(),console.log(h.chat_id+", "+d?.chat_id),h.chat_id===d?.chat_id&&(p(null),r("chats")),s(!1)},children:e.jsx("img",{alt:"Leave",className:"leave-chat-icon",src:J})})]})]},h.chat_id))}return e.jsx(e.Fragment,{children:e.jsxs("main",{id:"main-chat-page",className:`${c?"":"dark-mode"} mobile-view-${l}`,children:[d&&e.jsx("div",{className:`mobile-nav-arrows ${c?"":"dark-mode"}`,children:l==="messages"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`mobile-nav-arrow left ${c?"":"dark-mode"}`,onClick:()=>r("chats"),title:"Back to Chats",children:"â† Chats"}),e.jsx("span",{className:"mobile-chat-title",children:d.chat_name}),e.jsx("button",{className:`mobile-nav-arrow right ${c?"":"dark-mode"}`,onClick:()=>r("users"),title:"View Users",children:"Users â†’"})]}):l==="users"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`mobile-nav-arrow left ${c?"":"dark-mode"}`,onClick:()=>r("messages"),title:"Back to Messages",children:"â† Messages"}),e.jsx("span",{className:"mobile-chat-title",children:d.chat_name})]}):e.jsx(e.Fragment,{})}),e.jsxs("div",{id:"chat-list-container",className:c?"":"dark-mode",children:[e.jsx("button",{id:"show-create-chat-popup",className:c?"":"dark-mode",onClick:()=>o(!0),children:"Create Chat"}),e.jsx("input",{type:"text",id:"search-chats-bar",className:c?"":"dark-mode",placeholder:"Search chats...",value:u,onChange:h=>{g(h.target.value)}}),e.jsx("ul",{id:"chat-list",children:k})]}),d?e.jsxs(e.Fragment,{children:[e.jsx(W,{chat_name:d.chat_name,chat_id:d.chat_id,currentUser:a,ifLightMode:c,selectedChat:d,refreshChats:m}),e.jsx(V,{addMembersDisplay:n,setAddMembersDisplay:s,chat_id:d.chat_id,userList:d.userList,creator_id:d.creator_id,currentUser:a,currentFriends:i,ifLightMode:c,refreshChats:m})]}):e.jsx(e.Fragment,{})]})})}function W({chat_name:o,chat_id:n,currentUser:s,ifLightMode:a,selectedChat:t,refreshChats:i}){const[c,l]=j.useState(!1),[r,m]=j.useState(o);return e.jsxs("div",{id:"chat-layout",className:a?"":"dark-mode",children:[e.jsxs("p",{id:"chat-name",className:a?"":"dark-mode",children:[c?e.jsx("input",{className:a?"":"dark-mode",placeholder:"New chat name",id:"new-chat-name-input",type:"text",maxLength:30,value:r,onChange:d=>m(d.target.value)}):o,t.creator_id===s.id?c?e.jsx("button",{className:a?"":"dark-mode",id:"update-chat-name-btn",onClick:async()=>{await Z(l,r,n,s.id,t.creator_id,s.username),await i()},children:e.jsx("img",{src:B,id:"update-chat-icon",alt:"update"})}):e.jsx("button",{className:a?"":"dark-mode",id:"edit-chat-name-btn",onClick:()=>l(!c),children:e.jsx("img",{src:Y,id:"edit-chat-icon",alt:"edit"})}):e.jsx(e.Fragment,{})]}),e.jsx(A,{currentUser:s,chat_id:n,ifLightMode:a})]})}async function Z(o,n,s,a,t,i){o(!1);try{const l=await(await fetch("/api/chats/editChatName",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({newChatName:n,chat_id:s,user_id:a,creator_id:t,username:i})})).json();console.log(l.message)}catch(c){console.log(c)}}function V({addMembersDisplay:o,setAddMembersDisplay:n,chat_id:s,userList:a,creator_id:t,currentUser:i,currentFriends:c,ifLightMode:l,refreshChats:r}){const m=[],[d,p]=j.useState(null);for(const u of a){if(!u)continue;const{friend_id:g,user_id:x,status:k,username:h,joined_at:N,account_created:C,description:v,updated_at:F}=u;let y,b="";x!==i.id&&(k==="friends"?(y=" ðŸ‘¥",b="Friends"):k==="outgoing"?(y=e.jsx("button",{className:`cancel-req-btn ${l?"":"dark-mode"}`,onClick:()=>O(g??0,x,h??""),children:" Cancel "}),b=" Outgoing Request"):k==="incoming"?(y=e.jsxs("div",{className:"chat-incoming-req-btns",children:[e.jsx("button",{className:`reject-req-btn ${l?"":"dark-mode"}`,onClick:()=>P(g??0,h??"",x),children:" Reject "}),e.jsx("button",{className:`accept-req-btn ${l?"":"dark-mode"}`,onClick:()=>I(g??0,h??"",x),children:" Accept "})]}),b=" Incoming Request"):y=e.jsx("button",{className:`send-friend-req-btn ${l?"":"dark-mode"}`,onClick:()=>q(i.id,x),children:"Send Request"})),m.push(e.jsxs("li",{className:`chat-user-list ${l?"":"dark-mode"}`,onClick:()=>p(x),children:[d===x?e.jsx(U,{user_id:x,username:h??"",description:v??"",account_created:S(C??""),joined_at:S(N),friendsBtns:y,updated_at:S(F??""),descFriends:b,setUserDetailsOpen:p,currentUser:i,ifLightMode:l}):e.jsx(e.Fragment,{}),`${t===x?"ðŸ‘‘":""}`,h,i.id===x?"(You)":"",e.jsx("p",{className:`desc-friends ${l?"":"dark-mode"}`,children:b}),t===i.id&&i.id!==x?e.jsx("button",{className:`kick-btn ${l?"":"dark-mode"}`,onClick:async()=>{await G(t,i.id,i.username,x,h??"",s),await r()},children:"Kick"}):e.jsx(e.Fragment,{})]},`${s}-${u.username}`))}return e.jsxs("ul",{id:"chat-users-container",className:l?"":"dark-mode",children:[e.jsx("div",{id:"chat-users-header",className:l?"":"dark-mode",children:"Users in Chat:"}),m,e.jsx("button",{id:"add-members-btn",className:l?"":"dark-mode",onClick:()=>n(!0),children:"Add members"}),o?e.jsx(M,{setAddMembersDisplay:n,userList:a,currentFriends:c,chat_id:s,currentUser:i,ifLightMode:l,refreshChats:r}):e.jsx(e.Fragment,{})]})}function U({user_id:o,username:n,description:s,account_created:a,joined_at:t,friendsBtns:i,updated_at:c,descFriends:l,setUserDetailsOpen:r,currentUser:m,ifLightMode:d}){return e.jsxs("div",{id:"display-user-details",className:d?"":"dark-mode",children:[e.jsx("button",{id:"close-user-details",className:d?"":"dark-mode",onClick:p=>{p.stopPropagation(),r(null)},children:"X"}),e.jsxs("h3",{id:"display-user-username",className:d?"":"dark-mode",children:[e.jsx("b",{children:n})," ID: ",o," ",i]}),e.jsxs("p",{id:"creation-date",className:d?"":"dark-mode",children:["Account created at: ",a]}),e.jsxs("p",{id:"joined-date",className:d?"":"dark-mode",children:["Joined chat: ",t]}),m.id!==o?e.jsxs("p",{id:"friends-since",className:d?"":"dark-mode",children:[l," ",c?`Since ${c}`:""]}):e.jsx(e.Fragment,{}),e.jsxs("p",{id:"display-user-description",className:d?"":"dark-mode",children:["Description: ",s||"None added"]})]})}function M({setAddMembersDisplay:o,userList:n,currentFriends:s,chat_id:a,currentUser:t,ifLightMode:i,refreshChats:c}){const[l,r]=j.useState([]),m=s.filter(d=>!n.some(p=>p.user_id===d.user_id));return e.jsxs("div",{id:"add-friends-container",className:i?"":"dark-mode",children:[e.jsx("button",{id:"close-add-members-popup",className:i?"":"dark-mode",onClick:()=>o(!1),children:"X"}),e.jsx("h2",{className:i?"":"dark-mode",children:"Add Members"}),e.jsx("ul",{children:m.map(d=>{const p=l.some(u=>u.friend_id===d.friend_id);return e.jsx("li",{className:`add-members ${p?"selected":""} ${i?"":"dark-mode"}`,onClick:()=>{r(p?l.filter(u=>u.friend_id!==d.friend_id):[...l,d])},children:d.username},`add-members-${d.friend_id}`)})}),e.jsx("button",{id:"add-members-btn",className:i?"":"dark-mode",onClick:async()=>{await X(t.username,t.id,l,a,o),await c()},children:"Add"})]})}function S(o){const n=new Date(o),s=new Date;n.getFullYear()===s.getFullYear()&&n.getMonth()===s.getMonth()&&(n.getDate(),s.getDate());const a={month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0};return n.toLocaleString("en-US",a)}function L({currentFriends:o,currentUser:n,setCreateChatsDisplay:s,ifLightMode:a,refreshChats:t}){const[i,c]=j.useState([]),[l,r]=j.useState(""),[m,d]=j.useState(""),p=[];console.log(i);for(const u of o){const g=i.some(x=>x.friend_id===u.friend_id);p.push(e.jsx("li",{className:`create-chat-friends 
                ${g?"selected":""} ${a?"":"dark-mode"}`,onClick:()=>{if(g){const x=i.filter(k=>k.friend_id!==u.friend_id);c(x)}else c([...i,u])},children:u.username},`create-chats-popup-${u.friend_id}`))}return e.jsxs("div",{id:"create-chats-popup",className:a?"":"dark-mode",children:[e.jsx("button",{id:"close-create-chats-popup",className:a?"":"dark-mode",onClick:()=>s(!1),children:"X"}),e.jsx("h2",{className:a?"":"dark-mode",children:"Create Chat"}),e.jsx("ul",{children:p}),e.jsx("input",{placeholder:"Chat Name",id:"get-chat-name",className:a?"":"dark-mode",value:l,type:"text",maxLength:30,onChange:u=>r(u.target.value)}),e.jsx("button",{id:"create-chat-btn",className:a?"":"dark-mode",onClick:async()=>{await ee(n.username,n.id,i,l,r,c,s,d),await t()},children:"Create Chat"}),e.jsx("p",{id:"popup-display-msg",className:a?"":"dark-mode",children:m})]})}async function ee(o,n,s,a,t,i,c,l){try{const m=await(await fetch("/api/chats/createChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({creator_username:o,creator_id:n,addedFriends:s,chat_name:a})})).json();console.log(m.message),m.success?c(!1):l(m.message)}catch(r){console.log(r)}t(""),i([])}export{ne as default};
