import{r as g,j as e}from"./index-CKNt4adz.js";const $="/assets/gemini-logo-Bhs_9Dax.png";function F({currentUser:c,chat_id:t,ifLightMode:s}){const[a,n]=g.useState([]);return g.useEffect(()=>{if(!c?.id)return;S(c.id,n,t);const o=setInterval(()=>{S(c.id,n,t)},2e3);return()=>clearInterval(o)},[c?.id,t]),e.jsxs(e.Fragment,{children:[e.jsx(D,{pastMessageData:a,currentUser:c,chat_id:t,ifLightMode:s}),e.jsx(P,{currentUser:c,chat_id:t,ifLightMode:s,setMessageData:n})]})}const D=g.memo(function({pastMessageData:t,currentUser:s,chat_id:a,ifLightMode:n}){const o=g.useMemo(()=>{const d=[];for(const l of t){const{message_id:r,sender_id:m,message:i,username:u,sent_at:p,askGemini:x}=l;m!==-1&&x===1?d.push(e.jsxs("li",{className:`msg-container ${m===s.id?"your-msg":""} ${n?"":"dark-mode"}`,children:[e.jsxs("p",{className:`msg-username-date ${n?"":"dark-mode"}`,children:[u," ",b(p)]}),e.jsx("p",{className:`msg-text ${n?"":"dark-mode"}`,children:i}),e.jsxs("div",{className:`gemini-text ${n?"":"dark-mode"}`,children:[e.jsx("span",{children:"Ask Gemini"}),e.jsx("img",{src:$,alt:"gemini-logo",className:"gemini-logo"})]}),m===s.id?e.jsx("button",{onClick:()=>v(r,s.id,m,a),className:`delete-msg-btn ${n?"":"dark-mode"}`,children:"Delete"}):e.jsx(e.Fragment,{})]},r)):m===-1&&x===1?d.push(e.jsxs("li",{className:`ai-response-container ${n?"":"dark-mode"}`,children:[e.jsx("img",{src:$,alt:"gemini-logo",className:"gemini-logo"}),e.jsx("p",{className:`msg-text ${n?"":"dark-mode"}`,children:i}),e.jsx("p",{className:`msg-time ${n?"":"dark-mode"}`,children:b(p)})]},r)):m===-1?d.push(e.jsx("li",{className:"server-msg-container",children:e.jsxs("p",{className:`msg-text ${n?"":"dark-mode"}`,children:[i," ",b(p)]})},r)):d.push(e.jsxs("li",{className:`msg-container ${m===s.id?"your-msg":""} ${n?"":"dark-mode"}`,children:[e.jsxs("p",{className:`msg-username-date ${n?"":"dark-mode"}`,children:[u," ",b(p)]}),e.jsx("p",{className:`msg-text ${n?"":"dark-mode"}`,children:i}),m===s.id?e.jsx("button",{onClick:()=>v(r,s.id,m,a),className:`delete-msg-btn ${n?"":"dark-mode"}`,children:"Delete"}):e.jsx(e.Fragment,{})]},r))}return d},[t,s.id,a,n]);return e.jsx("ul",{id:"msg-display",className:n?"":"dark-mode",children:o})});function P({currentUser:c,chat_id:t,ifLightMode:s,setMessageData:a}){const[n,o]=g.useState(""),[d,l]=g.useState(!1);return e.jsxs("div",{id:"send-msg-input",className:s?"":"dark-mode",children:[e.jsx("input",{id:"message-send-bar",className:s?"":"dark-mode",placeholder:"Send Message",type:"text",value:n,onChange:r=>o(r.target.value)}),e.jsx("button",{id:"send-msg-btn",className:s?"":"dark-mode",onClick:()=>{d?J(o,l,n,t,c.id,c.username,a):q(t,n,c.id,o,a)},children:"Send"}),e.jsxs("div",{className:"gemini-checkbox-wrapper",children:[e.jsxs("label",{htmlFor:"if-ask-gemini",children:[e.jsx("img",{src:$,alt:"gemini-logo",className:"gemini-logo"})," Ask Gemini"]}),e.jsx("input",{id:"if-ask-gemini",className:s?"":"dark-mode",checked:d,onChange:()=>l(!d),type:"checkbox"})]})]})}function J(c,t,s,a,n,o,d){fetch("/api/gemini/prompt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:s,chat_id:a,user_id:n,username:o})}).then(async l=>{const r=await l.json();console.log(r.message)}).catch(l=>{console.log(l)}),c(""),t(!1),T(a,n),S(n,d,a)}function b(c){const t=new Date(c),s=new Date,a=t.getFullYear()===s.getFullYear()&&t.getMonth()===s.getMonth()&&t.getDate()===s.getDate(),n={month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0};return a?t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):t.toLocaleString("en-US",n)}function S(c,t,s){fetch(`/api/message/getMessages/${c}`,{method:"GET"}).then(async a=>{const n=await a.json();if(!n.success||!n.msgData){t([]);return}const o=n.msgData.find(d=>d.chat_id===s);t(o?o.messageData:[])}).catch(a=>{console.log(a),t([])})}function q(c,t,s,a,n){fetch("/api/message/sendMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:c,message:t,user_id:s})}).then(async o=>{const d=await o.json();console.log(d.message)}).catch(o=>{console.log(o)}),a(""),T(c,s),S(s,n,c)}function v(c,t,s,a){fetch("/api/message/deleteMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message_id:c,user_id:t,sender_id:s,chat_id:a})}).then(async n=>{const o=await n.json();console.log(o.message)}).catch(n=>{console.log(n)})}function T(c,t){fetch("/api/message/readMessages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:c,user_id:t})}).then(async s=>{const a=await s.json();console.log(a.message)}).catch(s=>{console.log(s)})}const I="/assets/leaveChatIcon-VdSxEAUK.png",A="/assets/edit-chat-name-icon-DvX9AU5r.png",E="/assets/update-chat-name-icon-TTeh5gq5.png";function ne({currentUser:c,currentFriends:t,ifLightMode:s,allChats:a,setAllChats:n}){const[o,d]=g.useState(!1),[l,r]=g.useState(!1),[m,i]=g.useState("chats"),u=async()=>{try{const x=await(await fetch(`/api/chats/displayChats/${c.id}`)).json();x.success&&x.chat_data&&n(x.chat_data)}catch(p){console.log("Error refreshing chats:",p)}};return e.jsxs(e.Fragment,{children:[o?e.jsx(ee,{currentFriends:t,currentUser:c,setCreateChatsDisplay:d,ifLightMode:s,refreshChats:u}):e.jsx(e.Fragment,{}),e.jsx(R,{setCreateChatsDisplay:d,addMembersDisplay:l,setAddMembersDisplay:r,currentUser:c,allChats:a,currentFriends:t,ifLightMode:s,mobileView:m,setMobileView:i,refreshChats:u})]})}function R({setCreateChatsDisplay:c,addMembersDisplay:t,setAddMembersDisplay:s,currentUser:a,allChats:n,currentFriends:o,ifLightMode:d,mobileView:l,setMobileView:r,refreshChats:m}){const[i,u]=g.useState(null),[p,x]=g.useState("");g.useEffect(()=>{if(!i)return;const h=n.find(N=>N.chat_id===i.chat_id);h?u(h):(u(null),r("chats"))},[n]),g.useEffect(()=>{i&&i.unread&&Q(i.chat_id,a.id)},[i]),g.useEffect(()=>{m()},[i?.chat_id]);const j=h=>{u(h),r("messages")},k=[];for(const h of n.filter(N=>N.chat_name.toLowerCase().includes(p.toLowerCase()))||[]){const{chat_name:N}=h;k.push(e.jsxs("li",{onClick:()=>j(h),className:`chat ${i?.chat_id===h.chat_id?"selected-chat":""} ${d?"":"dark-mode"}`,children:[e.jsxs("p",{className:"chat-name-sec",children:[N," ",h.unread?"ðŸ”´ unread messages":""]}),e.jsxs("div",{className:"chat-button-container",children:[h.creator_id===a.id?e.jsx("button",{id:"delete-chat-btn",className:d?"":"dark-mode",onClick:async y=>{y.stopPropagation(),await W(a.id,h.chat_id,h.creator_id),await m(),h.chat_id===i?.chat_id&&(u(null),r("chats")),s(!1)},children:"Delete"}):e.jsx(e.Fragment,{}),e.jsx("button",{id:"leave-btn",className:d?"":"dark-mode",onClick:async y=>{y.stopPropagation(),await Z(a.id,a.username,h.chat_id,h.creator_id),await m(),console.log(h.chat_id+", "+i?.chat_id),h.chat_id===i?.chat_id&&(u(null),r("chats")),s(!1)},children:e.jsx("img",{alt:"Leave",className:"leave-chat-icon",src:I})})]})]},h.chat_id))}return e.jsx(e.Fragment,{children:e.jsxs("main",{id:"main-chat-page",className:`${d?"":"dark-mode"} mobile-view-${l}`,children:[i&&e.jsx("div",{className:`mobile-nav-arrows ${d?"":"dark-mode"}`,children:l==="messages"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`mobile-nav-arrow left ${d?"":"dark-mode"}`,onClick:()=>r("chats"),title:"Back to Chats",children:"â† Chats"}),e.jsx("span",{className:"mobile-chat-title",children:i.chat_name}),e.jsx("button",{className:`mobile-nav-arrow right ${d?"":"dark-mode"}`,onClick:()=>r("users"),title:"View Users",children:"Users â†’"})]}):l==="users"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`mobile-nav-arrow left ${d?"":"dark-mode"}`,onClick:()=>r("messages"),title:"Back to Messages",children:"â† Messages"}),e.jsx("span",{className:"mobile-chat-title",children:i.chat_name})]}):e.jsx(e.Fragment,{})}),e.jsxs("div",{id:"chat-list-container",className:d?"":"dark-mode",children:[e.jsx("button",{id:"show-create-chat-popup",className:d?"":"dark-mode",onClick:()=>c(!0),children:"Create Chat"}),e.jsx("input",{type:"text",id:"search-chats-bar",className:d?"":"dark-mode",placeholder:"Search chats...",value:p,onChange:h=>{x(h.target.value)}}),e.jsx("ul",{id:"chat-list",children:k})]}),i?e.jsxs(e.Fragment,{children:[e.jsx(B,{chat_name:i.chat_name,chat_id:i.chat_id,currentUser:a,ifLightMode:d,selectedChat:i,refreshChats:m}),e.jsx(G,{addMembersDisplay:t,setAddMembersDisplay:s,chat_id:i.chat_id,userList:i.userList,creator_id:i.creator_id,currentUser:a,currentFriends:o,ifLightMode:d,refreshChats:m})]}):e.jsx(e.Fragment,{})]})})}function B({chat_name:c,chat_id:t,currentUser:s,ifLightMode:a,selectedChat:n,refreshChats:o}){const[d,l]=g.useState(!1),[r,m]=g.useState(c);return e.jsxs("div",{id:"chat-layout",className:a?"":"dark-mode",children:[e.jsxs("p",{id:"chat-name",className:a?"":"dark-mode",children:[d?e.jsx("input",{className:a?"":"dark-mode",placeholder:"New chat name",id:"new-chat-name-input",type:"text",maxLength:30,value:r,onChange:i=>m(i.target.value)}):c,n.creator_id===s.id?d?e.jsx("button",{className:a?"":"dark-mode",id:"update-chat-name-btn",onClick:async()=>{await Y(l,r,t,s.id,n.creator_id,s.username),await o()},children:e.jsx("img",{src:E,id:"update-chat-icon",alt:"update"})}):e.jsx("button",{className:a?"":"dark-mode",id:"edit-chat-name-btn",onClick:()=>l(!d),children:e.jsx("img",{src:A,id:"edit-chat-icon",alt:"edit"})}):e.jsx(e.Fragment,{})]}),e.jsx(F,{currentUser:s,chat_id:t,ifLightMode:a})]})}async function Y(c,t,s,a,n,o){c(!1);try{const l=await(await fetch("/api/chats/editChatName",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({newChatName:t,chat_id:s,user_id:a,creator_id:n,username:o})})).json();console.log(l.message)}catch(d){console.log(d)}}function G({addMembersDisplay:c,setAddMembersDisplay:t,chat_id:s,userList:a,creator_id:n,currentUser:o,currentFriends:d,ifLightMode:l,refreshChats:r}){const m=[],[i,u]=g.useState(null);for(const p of a){if(!p)continue;const{friend_id:x,user_id:j,status:k,username:h,joined_at:N,account_created:y,description:_,updated_at:O}=p;let f,C="";j!==o.id&&(k==="friends"?(f=" ðŸ‘¥",C="Friends"):k==="outgoing"?(f=e.jsx("button",{className:`cancel-req-btn ${l?"":"dark-mode"}`,onClick:()=>U(x??0,j,h??""),children:" Cancel "}),C=" Outgoing Request"):k==="incoming"?(f=e.jsxs("div",{className:"chat-incoming-req-btns",children:[e.jsx("button",{className:`reject-req-btn ${l?"":"dark-mode"}`,onClick:()=>M(x??0,h??"",j),children:" Reject "}),e.jsx("button",{className:`accept-req-btn ${l?"":"dark-mode"}`,onClick:()=>L(x??0,h??"",j),children:" Accept "})]}),C=" Incoming Request"):f=e.jsx("button",{className:`send-friend-req-btn ${l?"":"dark-mode"}`,onClick:()=>V(o.id,j),children:"Send Request"})),m.push(e.jsxs("li",{className:`chat-user-list ${l?"":"dark-mode"}`,onClick:()=>u(j),children:[i===j?e.jsx(X,{user_id:j,username:h??"",description:_??"",account_created:w(y??""),joined_at:w(N),friendsBtns:f,updated_at:w(O??""),descFriends:C,setUserDetailsOpen:u,currentUser:o,ifLightMode:l}):e.jsx(e.Fragment,{}),`${n===j?"ðŸ‘‘":""}`,h,o.id===j?"(You)":"",e.jsx("p",{className:`desc-friends ${l?"":"dark-mode"}`,children:C}),n===o.id&&o.id!==j?e.jsx("button",{className:`kick-btn ${l?"":"dark-mode"}`,onClick:async()=>{await H(n,o.id,o.username,j,h??"",s),await r()},children:"Kick"}):e.jsx(e.Fragment,{})]},`${s}-${p.username}`))}return e.jsxs("ul",{id:"chat-users-container",className:l?"":"dark-mode",children:[e.jsx("div",{id:"chat-users-header",className:l?"":"dark-mode",children:"Users in Chat:"}),m,e.jsx("button",{id:"add-members-btn",className:l?"":"dark-mode",onClick:()=>t(!0),children:"Add members"}),c?e.jsx(K,{setAddMembersDisplay:t,userList:a,currentFriends:d,chat_id:s,currentUser:o,ifLightMode:l,refreshChats:r}):e.jsx(e.Fragment,{})]})}function X({user_id:c,username:t,description:s,account_created:a,joined_at:n,friendsBtns:o,updated_at:d,descFriends:l,setUserDetailsOpen:r,currentUser:m,ifLightMode:i}){return e.jsxs("div",{id:"display-user-details",className:i?"":"dark-mode",children:[e.jsx("button",{id:"close-user-details",className:i?"":"dark-mode",onClick:u=>{u.stopPropagation(),r(null)},children:"X"}),e.jsxs("h3",{id:"display-user-username",className:i?"":"dark-mode",children:[e.jsx("b",{children:t})," ID: ",c," ",o]}),e.jsxs("p",{id:"creation-date",className:i?"":"dark-mode",children:["Account created at: ",a]}),e.jsxs("p",{id:"joined-date",className:i?"":"dark-mode",children:["Joined chat: ",n]}),m.id!==c?e.jsxs("p",{id:"friends-since",className:i?"":"dark-mode",children:[l," ",d?`Since ${d}`:""]}):e.jsx(e.Fragment,{}),e.jsxs("p",{id:"display-user-description",className:i?"":"dark-mode",children:["Description: ",s||"None added"]})]})}function K({setAddMembersDisplay:c,userList:t,currentFriends:s,chat_id:a,currentUser:n,ifLightMode:o,refreshChats:d}){const[l,r]=g.useState([]),m=s.filter(i=>!t.some(u=>u.user_id===i.user_id));return e.jsxs("div",{id:"add-friends-container",className:o?"":"dark-mode",children:[e.jsx("button",{id:"close-add-members-popup",className:o?"":"dark-mode",onClick:()=>c(!1),children:"X"}),e.jsx("h2",{className:o?"":"dark-mode",children:"Add Members"}),e.jsx("ul",{children:m.map(i=>{const u=l.some(p=>p.friend_id===i.friend_id);return e.jsx("li",{className:`add-members ${u?"selected":""} ${o?"":"dark-mode"}`,onClick:()=>{r(u?l.filter(p=>p.friend_id!==i.friend_id):[...l,i])},children:i.username},`add-members-${i.friend_id}`)})}),e.jsx("button",{id:"add-members-btn",className:o?"":"dark-mode",onClick:async()=>{await z(n.username,n.id,l,a,c),await d()},children:"Add"})]})}function w(c){const t=new Date(c),s=new Date;t.getFullYear()===s.getFullYear()&&t.getMonth()===s.getMonth()&&(t.getDate(),s.getDate());const a={month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0};return t.toLocaleString("en-US",a)}async function z(c,t,s,a,n){if(n(!1),s.length===0){console.log("No friends selected");return}try{const d=await(await fetch("/api/chats/addToChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:c,user_id:t,addedFriends:s,chat_id:a})})).json();console.log(d.message)}catch(o){console.log(o)}}async function H(c,t,s,a,n,o){try{const l=await(await fetch("/api/chats/kick",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({creator_id:c,user_id:t,user_username:s,kicked_id:a,kicked_username:n,chat_id:o})})).json();console.log(l.message)}catch(d){console.log(d)}}function Q(c,t){fetch("/api/message/readMessages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:c,user_id:t})}).then(async s=>{const a=await s.json();console.log(a.message)}).catch(s=>{console.log(s)})}async function W(c,t,s){try{const n=await(await fetch("/api/chats/deleteChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:c,chat_id:t,creator_id:s})})).json();console.log(n.message)}catch(a){console.log(a)}}async function Z(c,t,s,a){try{const o=await(await fetch("/api/chats/leaveChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:c,username:t,chat_id:s,creator_id:a})})).json();console.log(o.message)}catch(n){console.log(n)}}function V(c,t){fetch("/api/friends/sendFriendRequest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sender_id:c,receiver_id:t})}).then(async s=>{const a=await s.json();console.log(a)}).catch(s=>{console.log(s)})}function U(c,t,s){fetch("/api/friends/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({friend_id:c,receiver_id:t,receiver_username:s})}).then(async a=>{const n=await a.json();console.log(n.message)}).catch(a=>{console.log(a)})}function M(c,t,s){fetch("/api/friends/reject",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({friend_id:c,sender_id:s,sender_username:t})}).then(async a=>{const n=await a.json();console.log(n.message)}).catch(a=>{console.log(a)})}function L(c,t,s){fetch("/api/friends/accept",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({friend_id:c,sender_id:s,sender_username:t})}).then(async a=>{const n=await a.json();console.log(n.message)}).catch(a=>{console.log(a)})}function ee({currentFriends:c,currentUser:t,setCreateChatsDisplay:s,ifLightMode:a,refreshChats:n}){const[o,d]=g.useState([]),[l,r]=g.useState(""),[m,i]=g.useState(""),u=[];console.log(o);for(const p of c){const x=o.some(j=>j.friend_id===p.friend_id);u.push(e.jsx("li",{className:`create-chat-friends 
                ${x?"selected":""} ${a?"":"dark-mode"}`,onClick:()=>{if(x){const j=o.filter(k=>k.friend_id!==p.friend_id);d(j)}else d([...o,p])},children:p.username},`create-chats-popup-${p.friend_id}`))}return e.jsxs("div",{id:"create-chats-popup",className:a?"":"dark-mode",children:[e.jsx("button",{id:"close-create-chats-popup",className:a?"":"dark-mode",onClick:()=>s(!1),children:"X"}),e.jsx("h2",{className:a?"":"dark-mode",children:"Create Chat"}),e.jsx("ul",{children:u}),e.jsx("input",{placeholder:"Chat Name",id:"get-chat-name",className:a?"":"dark-mode",value:l,type:"text",maxLength:30,onChange:p=>r(p.target.value)}),e.jsx("button",{id:"create-chat-btn",className:a?"":"dark-mode",onClick:async()=>{await se(t.username,t.id,o,l,r,d,s,i),await n()},children:"Create Chat"}),e.jsx("p",{id:"popup-display-msg",className:a?"":"dark-mode",children:m})]})}async function se(c,t,s,a,n,o,d,l){try{const m=await(await fetch("/api/chats/createChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({creator_username:c,creator_id:t,addedFriends:s,chat_name:a})})).json();console.log(m.message),m.success?d(!1):l(m.message)}catch(r){console.log(r)}n(""),o([])}export{ne as default};
