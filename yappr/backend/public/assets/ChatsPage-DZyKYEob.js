import{r as j,j as e}from"./index-CZZQt8Co.js";import{g as $,a as _,d as w,s as D,p as T}from"./MessageFunctions-DUnXJg01.js";import{c as O,r as I,a as P,s as q}from"./FriendsFunctions-MZtW1pYR.js";function A({currentUser:i,chat_id:n,ifLightMode:s}){const[t,a]=j.useState([]);return j.useEffect(()=>{if(!i?.id)return;$(i.id,a,n);const d=setInterval(()=>{$(i.id,a,n)},2e3);return()=>clearInterval(d)},[i?.id,n]),e.jsxs(e.Fragment,{children:[e.jsx(E,{pastMessageData:t,currentUser:i,chat_id:n,ifLightMode:s}),e.jsx(R,{currentUser:i,chat_id:n,ifLightMode:s,setMessageData:a})]})}const E=j.memo(function({pastMessageData:n,currentUser:s,chat_id:t,ifLightMode:a}){const d=j.useMemo(()=>{const c=[];for(const l of n){const{message_id:r,sender_id:m,message:o,username:p,sent_at:u,askGemini:g}=l;m!==-1&&g===1?c.push(e.jsxs("li",{className:`msg-container ${m===s.id?"your-msg":""} ${a?"":"dark-mode"}`,children:[e.jsxs("p",{className:`msg-username-date ${a?"":"dark-mode"}`,children:[p," ",f(u)]}),e.jsx("p",{className:`msg-text ${a?"":"dark-mode"}`,children:o}),e.jsxs("div",{className:`gemini-text ${a?"":"dark-mode"}`,children:[e.jsx("span",{children:"Ask Gemini"}),e.jsx("img",{src:_,alt:"gemini-logo",className:"gemini-logo"})]}),m===s.id?e.jsx("button",{onClick:()=>w(r,s.id,m,t),className:`delete-msg-btn ${a?"":"dark-mode"}`,children:"Delete"}):e.jsx(e.Fragment,{})]},r)):m===-1&&g===1?c.push(e.jsxs("li",{className:`ai-response-container ${a?"":"dark-mode"}`,children:[e.jsx("img",{src:_,alt:"gemini-logo",className:"gemini-logo"}),e.jsx("p",{className:`msg-text ${a?"":"dark-mode"}`,children:o}),e.jsx("p",{className:`msg-time ${a?"":"dark-mode"}`,children:f(u)})]},r)):m===-1?c.push(e.jsx("li",{className:"server-msg-container",children:e.jsxs("p",{className:`msg-text ${a?"":"dark-mode"}`,children:[o," ",f(u)]})},r)):c.push(e.jsxs("li",{className:`msg-container ${m===s.id?"your-msg":""} ${a?"":"dark-mode"}`,children:[e.jsxs("p",{className:`msg-username-date ${a?"":"dark-mode"}`,children:[p," ",f(u)]}),e.jsx("p",{className:`msg-text ${a?"":"dark-mode"}`,children:o}),m===s.id?e.jsx("button",{onClick:()=>w(r,s.id,m,t),className:`delete-msg-btn ${a?"":"dark-mode"}`,children:"Delete"}):e.jsx(e.Fragment,{})]},r))}return c},[n,s.id,t,a]);return e.jsx("ul",{id:"msg-display",className:a?"":"dark-mode",children:d})});function R({currentUser:i,chat_id:n,ifLightMode:s,setMessageData:t}){const[a,d]=j.useState(""),[c,l]=j.useState(!1);return e.jsxs("div",{id:"send-msg-input",className:s?"":"dark-mode",children:[e.jsx("input",{id:"message-send-bar",className:s?"":"dark-mode",placeholder:"Send Message",type:"text",value:a,onChange:r=>d(r.target.value)}),e.jsx("button",{id:"send-msg-btn",className:s?"":"dark-mode",onClick:()=>{c?T(d,l,a,n,i.id,i.username,t):D(n,a,i.id,d,t)},children:"Send"}),e.jsxs("div",{className:`gemini-checkbox-wrapper${s?"":" dark-mode"}`,children:[e.jsxs("label",{htmlFor:"if-ask-gemini",children:[e.jsx("img",{src:_,alt:"gemini-logo",className:"gemini-logo"})," Ask Gemini"]}),e.jsx("input",{id:"if-ask-gemini",className:s?"":"dark-mode",checked:c,onChange:()=>l(!c),type:"checkbox"})]})]})}function f(i){const n=new Date(i),s=new Date,t=n.getFullYear()===s.getFullYear()&&n.getMonth()===s.getMonth()&&n.getDate()===s.getDate(),a=Intl.DateTimeFormat().resolvedOptions().timeZone,d={month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0,timeZone:a};return t?n.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0,timeZone:a}):n.toLocaleString("en-US",d)}const J="/assets/leaveChatIcon-VdSxEAUK.png",Z="/assets/edit-chat-name-icon-DvX9AU5r.png",Y="/assets/update-chat-name-icon-TTeh5gq5.png";async function B(i,n,s,t,a){if(a(!1),s.length===0){console.log("No friends selected");return}try{const c=await(await fetch("/api/chats/addToChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:i,user_id:n,addedFriends:s,chat_id:t})})).json();console.log(c.message)}catch(d){console.log(d)}}async function X(i,n,s,t,a,d){try{const l=await(await fetch("/api/chats/kick",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({creator_id:i,user_id:n,user_username:s,kicked_id:t,kicked_username:a,chat_id:d})})).json();console.log(l.message)}catch(c){console.log(c)}}function G(i,n){fetch("/api/message/readMessages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:i,user_id:n})}).then(async s=>{const t=await s.json();console.log(t.message)}).catch(s=>{console.log(s)})}async function K(i,n,s){try{const a=await(await fetch("/api/chats/deleteChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:i,chat_id:n,creator_id:s})})).json();console.log(a.message)}catch(t){console.log(t)}}async function z(i,n,s,t){try{const d=await(await fetch("/api/chats/leaveChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:i,username:n,chat_id:s,creator_id:t})})).json();console.log(d.message)}catch(a){console.log(a)}}function ne({currentUser:i,currentFriends:n,ifLightMode:s,allChats:t,setAllChats:a}){const[d,c]=j.useState(!1),[l,r]=j.useState(!1),[m,o]=j.useState("chats"),p=async()=>{try{const g=await(await fetch(`/api/chats/displayChats/${i.id}`)).json();g.success&&g.chat_data&&a(g.chat_data)}catch(u){console.log("Error refreshing chats:",u)}};return e.jsxs(e.Fragment,{children:[d?e.jsx(L,{currentFriends:n,currentUser:i,setCreateChatsDisplay:c,ifLightMode:s,refreshChats:p}):e.jsx(e.Fragment,{}),e.jsx(H,{setCreateChatsDisplay:c,addMembersDisplay:l,setAddMembersDisplay:r,currentUser:i,allChats:t,currentFriends:n,ifLightMode:s,mobileView:m,setMobileView:o,refreshChats:p})]})}function H({setCreateChatsDisplay:i,addMembersDisplay:n,setAddMembersDisplay:s,currentUser:t,allChats:a,currentFriends:d,ifLightMode:c,mobileView:l,setMobileView:r,refreshChats:m}){const[o,p]=j.useState(null),[u,g]=j.useState("");j.useEffect(()=>{if(!o)return;const h=a.find(N=>N.chat_id===o.chat_id);h?p(h):(p(null),r("chats"))},[a]),j.useEffect(()=>{o&&o.unread&&G(o.chat_id,t.id)},[o]),j.useEffect(()=>{m()},[o?.chat_id]);const x=h=>{p(h),r("messages")},k=[];for(const h of a.filter(N=>N.chat_name.toLowerCase().includes(u.toLowerCase()))||[]){const{chat_name:N}=h;k.push(e.jsxs("li",{onClick:()=>x(h),className:`chat ${o?.chat_id===h.chat_id?"selected-chat":""} ${c?"":"dark-mode"}`,children:[e.jsxs("p",{className:"chat-name-sec",children:[N," ",h.unread?"ðŸ”´ unread messages":""]}),e.jsxs("div",{className:"chat-button-container",children:[h.creator_id===t.id?e.jsx("button",{id:"delete-chat-btn",className:c?"":"dark-mode",onClick:async C=>{C.stopPropagation(),await K(t.id,h.chat_id,h.creator_id),await m(),h.chat_id===o?.chat_id&&(p(null),r("chats")),s(!1)},children:"Delete"}):e.jsx(e.Fragment,{}),e.jsx("button",{id:"leave-btn",className:c?"":"dark-mode",onClick:async C=>{C.stopPropagation(),await z(t.id,t.username,h.chat_id,h.creator_id),await m(),console.log(h.chat_id+", "+o?.chat_id),h.chat_id===o?.chat_id&&(p(null),r("chats")),s(!1)},children:e.jsx("img",{alt:"Leave",className:"leave-chat-icon",src:J})})]})]},h.chat_id))}return e.jsx(e.Fragment,{children:e.jsxs("main",{id:"main-chat-page",className:`${c?"":"dark-mode"} mobile-view-${l}`,children:[o&&e.jsx("div",{className:`mobile-nav-arrows ${c?"":"dark-mode"}`,children:l==="messages"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`mobile-nav-arrow left ${c?"":"dark-mode"}`,onClick:()=>r("chats"),title:"Back to Chats",children:"â† Chats"}),e.jsx("span",{className:"mobile-chat-title",children:o.chat_name}),e.jsx("button",{className:`mobile-nav-arrow right ${c?"":"dark-mode"}`,onClick:()=>r("users"),title:"View Users",children:"Users â†’"})]}):l==="users"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`mobile-nav-arrow left ${c?"":"dark-mode"}`,onClick:()=>r("messages"),title:"Back to Messages",children:"â† Messages"}),e.jsx("span",{className:"mobile-chat-title",children:o.chat_name})]}):e.jsx(e.Fragment,{})}),e.jsxs("div",{id:"chat-list-container",className:c?"":"dark-mode",children:[e.jsx("button",{id:"show-create-chat-popup",className:c?"":"dark-mode",onClick:()=>i(!0),children:"Create Chat"}),e.jsx("input",{type:"text",id:"search-chats-bar",className:c?"":"dark-mode",placeholder:"Search chats...",value:u,onChange:h=>{g(h.target.value)}}),e.jsx("ul",{id:"chat-list",children:k})]}),o?e.jsxs(e.Fragment,{children:[e.jsx(Q,{chat_name:o.chat_name,chat_id:o.chat_id,currentUser:t,ifLightMode:c,selectedChat:o,refreshChats:m}),e.jsx(V,{addMembersDisplay:n,setAddMembersDisplay:s,chat_id:o.chat_id,userList:o.userList,creator_id:o.creator_id,currentUser:t,currentFriends:d,ifLightMode:c,refreshChats:m})]}):e.jsx(e.Fragment,{})]})})}function Q({chat_name:i,chat_id:n,currentUser:s,ifLightMode:t,selectedChat:a,refreshChats:d}){const[c,l]=j.useState(!1),[r,m]=j.useState(i);return e.jsxs("div",{id:"chat-layout",className:t?"":"dark-mode",children:[e.jsxs("p",{id:"chat-name",className:t?"":"dark-mode",children:[c?e.jsx("input",{className:t?"":"dark-mode",placeholder:"New chat name",id:"new-chat-name-input",type:"text",maxLength:30,value:r,onChange:o=>m(o.target.value)}):i,a.creator_id===s.id?c?e.jsx("button",{className:t?"":"dark-mode",id:"update-chat-name-btn",onClick:async()=>{await W(l,r,n,s.id,a.creator_id,s.username),await d()},children:e.jsx("img",{src:Y,id:"update-chat-icon",alt:"update"})}):e.jsx("button",{className:t?"":"dark-mode",id:"edit-chat-name-btn",onClick:()=>l(!c),children:e.jsx("img",{src:Z,id:"edit-chat-icon",alt:"edit"})}):e.jsx(e.Fragment,{})]}),e.jsx(A,{currentUser:s,chat_id:n,ifLightMode:t})]})}async function W(i,n,s,t,a,d){i(!1);try{const l=await(await fetch("/api/chats/editChatName",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({newChatName:n,chat_id:s,user_id:t,creator_id:a,username:d})})).json();console.log(l.message)}catch(c){console.log(c)}}function V({addMembersDisplay:i,setAddMembersDisplay:n,chat_id:s,userList:t,creator_id:a,currentUser:d,currentFriends:c,ifLightMode:l,refreshChats:r}){const m=[],[o,p]=j.useState(null);for(const u of t){if(!u)continue;const{friend_id:g,user_id:x,status:k,username:h,joined_at:N,account_created:C,description:v,updated_at:F}=u;let y,b="";x!==d.id&&(k==="friends"?(y=" ðŸ‘¥",b="Friends"):k==="outgoing"?(y=e.jsx("button",{className:`cancel-req-btn ${l?"":"dark-mode"}`,onClick:()=>O(g??0,x,h??""),children:" Cancel "}),b=" Outgoing Request"):k==="incoming"?(y=e.jsxs("div",{className:"chat-incoming-req-btns",children:[e.jsx("button",{className:`reject-req-btn ${l?"":"dark-mode"}`,onClick:()=>I(g??0,h??"",x),children:" Reject "}),e.jsx("button",{className:`accept-req-btn ${l?"":"dark-mode"}`,onClick:()=>P(g??0,h??"",x),children:" Accept "})]}),b=" Incoming Request"):y=e.jsx("button",{className:`send-friend-req-btn ${l?"":"dark-mode"}`,onClick:()=>q(d.id,x),children:"Send Request"})),m.push(e.jsxs("li",{className:`chat-user-list ${l?"":"dark-mode"}`,onClick:()=>p(x),children:[o===x?e.jsx(U,{user_id:x,username:h??"",description:v??"",account_created:S(C??""),joined_at:S(N),friendsBtns:y,updated_at:S(F??""),descFriends:b,setUserDetailsOpen:p,currentUser:d,ifLightMode:l}):e.jsx(e.Fragment,{}),`${a===x?"ðŸ‘‘":""}`,h,d.id===x?"(You)":"",e.jsx("p",{className:`desc-friends ${l?"":"dark-mode"}`,children:b}),a===d.id&&d.id!==x?e.jsx("button",{className:`kick-btn ${l?"":"dark-mode"}`,onClick:async()=>{await X(a,d.id,d.username,x,h??"",s),await r()},children:"Kick"}):e.jsx(e.Fragment,{})]},`${s}-${u.username}`))}return e.jsxs("ul",{id:"chat-users-container",className:l?"":"dark-mode",children:[e.jsx("div",{id:"chat-users-header",className:l?"":"dark-mode",children:"Users in Chat:"}),m,e.jsx("button",{id:"add-members-btn",className:l?"":"dark-mode",onClick:()=>n(!0),children:"Add members"}),i?e.jsx(M,{setAddMembersDisplay:n,userList:t,currentFriends:c,chat_id:s,currentUser:d,ifLightMode:l,refreshChats:r}):e.jsx(e.Fragment,{})]})}function U({user_id:i,username:n,description:s,account_created:t,joined_at:a,friendsBtns:d,updated_at:c,descFriends:l,setUserDetailsOpen:r,currentUser:m,ifLightMode:o}){return e.jsxs("div",{id:"display-user-details",className:o?"":"dark-mode",children:[e.jsx("button",{id:"close-user-details",className:o?"":"dark-mode",onClick:p=>{p.stopPropagation(),r(null)},children:"X"}),e.jsxs("h3",{id:"display-user-username",className:o?"":"dark-mode",children:[e.jsx("b",{children:n})," ID: ",i," ",d]}),e.jsxs("p",{id:"creation-date",className:o?"":"dark-mode",children:["Account created at: ",t]}),e.jsxs("p",{id:"joined-date",className:o?"":"dark-mode",children:["Joined chat: ",a]}),m.id!==i?e.jsxs("p",{id:"friends-since",className:o?"":"dark-mode",children:[l," ",c?`Since ${c}`:""]}):e.jsx(e.Fragment,{}),e.jsxs("p",{id:"display-user-description",className:o?"":"dark-mode",children:["Description: ",s||"None added"]})]})}function M({setAddMembersDisplay:i,userList:n,currentFriends:s,chat_id:t,currentUser:a,ifLightMode:d,refreshChats:c}){const[l,r]=j.useState([]),m=s.filter(o=>!n.some(p=>p.user_id===o.user_id));return e.jsxs("div",{id:"add-friends-container",className:d?"":"dark-mode",children:[e.jsx("button",{id:"close-add-members-popup",className:d?"":"dark-mode",onClick:()=>i(!1),children:"X"}),e.jsx("h2",{className:d?"":"dark-mode",children:"Add Members"}),e.jsx("ul",{children:m.map(o=>{const p=l.some(u=>u.friend_id===o.friend_id);return e.jsx("li",{className:`add-members ${p?"selected":""} ${d?"":"dark-mode"}`,onClick:()=>{r(p?l.filter(u=>u.friend_id!==o.friend_id):[...l,o])},children:o.username},`add-members-${o.friend_id}`)})}),e.jsx("button",{id:"add-members-btn",className:d?"":"dark-mode",onClick:async()=>{await B(a.username,a.id,l,t,i),await c()},children:"Add"})]})}function S(i){const n=new Date(i),s=new Date;n.getFullYear()===s.getFullYear()&&n.getMonth()===s.getMonth()&&(n.getDate(),s.getDate());const a={month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone};return n.toLocaleString("en-US",a)}function L({currentFriends:i,currentUser:n,setCreateChatsDisplay:s,ifLightMode:t,refreshChats:a}){const[d,c]=j.useState([]),[l,r]=j.useState(""),[m,o]=j.useState(""),p=[];console.log(d);for(const u of i){const g=d.some(x=>x.friend_id===u.friend_id);p.push(e.jsx("li",{className:`create-chat-friends 
                ${g?"selected":""} ${t?"":"dark-mode"}`,onClick:()=>{if(g){const x=d.filter(k=>k.friend_id!==u.friend_id);c(x)}else c([...d,u])},children:u.username},`create-chats-popup-${u.friend_id}`))}return e.jsxs("div",{id:"create-chats-popup",className:t?"":"dark-mode",children:[e.jsx("button",{id:"close-create-chats-popup",className:t?"":"dark-mode",onClick:()=>s(!1),children:"X"}),e.jsx("h2",{className:t?"":"dark-mode",children:"Create Chat"}),e.jsx("ul",{children:p}),e.jsx("input",{placeholder:"Chat Name",id:"get-chat-name",className:t?"":"dark-mode",value:l,type:"text",maxLength:30,onChange:u=>r(u.target.value)}),e.jsx("button",{id:"create-chat-btn",className:t?"":"dark-mode",onClick:async()=>{await ee(n.username,n.id,d,l,r,c,s,o),await a()},children:"Create Chat"}),e.jsx("p",{id:"popup-display-msg",className:t?"":"dark-mode",children:m})]})}async function ee(i,n,s,t,a,d,c,l){try{const m=await(await fetch("/api/chats/createChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({creator_username:i,creator_id:n,addedFriends:s,chat_name:t})})).json();console.log(m.message),m.success?c(!1):l(m.message)}catch(r){console.log(r)}a(""),d([])}export{ne as default};
