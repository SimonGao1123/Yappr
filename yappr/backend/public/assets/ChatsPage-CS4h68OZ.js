import{r as g,j as e}from"./index-D35lV0e3.js";const S="/assets/gemini-logo-Bhs_9Dax.png";function w({currentUser:c,chat_id:t,ifLightMode:a}){const[s,n]=g.useState([]);return g.useEffect(()=>{if(!c?.id)return;$(c.id,n,t);const d=setInterval(()=>{$(c.id,n,t)},2e3);return()=>clearInterval(d)},[c?.id,t]),e.jsxs(e.Fragment,{children:[e.jsx(D,{pastMessageData:s,currentUser:c,chat_id:t,ifLightMode:a}),e.jsx(F,{currentUser:c,chat_id:t,ifLightMode:a})]})}const D=g.memo(function({pastMessageData:t,currentUser:a,chat_id:s,ifLightMode:n}){const d=g.useMemo(()=>{const o=[];for(const i of t){const{message_id:r,sender_id:l,message:m,username:u,sent_at:j,askGemini:p}=i;l!==-1&&p===1?o.push(e.jsxs("li",{className:`msg-container ${l===a.id?"your-msg":""} ${n?"":"dark-mode"}`,children:[e.jsxs("p",{className:`msg-username-date ${n?"":"dark-mode"}`,children:[u," ",f(j)]}),e.jsx("p",{className:`msg-text ${n?"":"dark-mode"}`,children:m}),e.jsxs("div",{className:`gemini-text ${n?"":"dark-mode"}`,children:[e.jsx("span",{children:"Ask Gemini"}),e.jsx("img",{src:S,alt:"gemini-logo",className:"gemini-logo"})]}),l===a.id?e.jsx("button",{onClick:()=>_(r,a.id,l,s),className:`delete-msg-btn ${n?"":"dark-mode"}`,children:"Delete"}):e.jsx(e.Fragment,{})]},r)):l===-1&&p===1?o.push(e.jsxs("li",{className:`ai-response-container ${n?"":"dark-mode"}`,children:[e.jsx("img",{src:S,alt:"gemini-logo",className:"gemini-logo"}),e.jsx("p",{className:`msg-text ${n?"":"dark-mode"}`,children:m}),e.jsx("p",{className:`msg-time ${n?"":"dark-mode"}`,children:f(j)})]},r)):l===-1?o.push(e.jsx("li",{className:"server-msg-container",children:e.jsxs("p",{className:`msg-text ${n?"":"dark-mode"}`,children:[m," ",f(j)]})},r)):o.push(e.jsxs("li",{className:`msg-container ${l===a.id?"your-msg":""} ${n?"":"dark-mode"}`,children:[e.jsxs("p",{className:`msg-username-date ${n?"":"dark-mode"}`,children:[u," ",f(j)]}),e.jsx("p",{className:`msg-text ${n?"":"dark-mode"}`,children:m}),l===a.id?e.jsx("button",{onClick:()=>_(r,a.id,l,s),className:`delete-msg-btn ${n?"":"dark-mode"}`,children:"Delete"}):e.jsx(e.Fragment,{})]},r))}return o},[t,a.id,s,n]);return e.jsx("ul",{id:"msg-display",className:n?"":"dark-mode",children:d})});function F({currentUser:c,chat_id:t,ifLightMode:a}){const[s,n]=g.useState(""),[d,o]=g.useState(!1);return e.jsxs("div",{id:"send-msg-input",className:a?"":"dark-mode",children:[e.jsx("input",{id:"message-send-bar",className:a?"":"dark-mode",placeholder:"Send Message",type:"text",value:s,onChange:i=>n(i.target.value)}),e.jsx("button",{id:"send-msg-btn",className:a?"":"dark-mode",onClick:()=>{d?P(n,o,s,t,c.id,c.username):J(t,s,c.id,n)},children:"Send"}),e.jsxs("div",{className:"gemini-checkbox-wrapper",children:[e.jsxs("label",{htmlFor:"if-ask-gemini",children:[e.jsx("img",{src:S,alt:"gemini-logo",className:"gemini-logo"})," Ask Gemini"]}),e.jsx("input",{id:"if-ask-gemini",className:a?"":"dark-mode",checked:d,onChange:()=>o(!d),type:"checkbox"})]})]})}function P(c,t,a,s,n,d){fetch("/gemini/prompt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:a,chat_id:s,user_id:n,username:d})}).then(async o=>{const i=await o.json();console.log(i.message)}).catch(o=>{console.log(o)}),c(""),t(!1),v(s,n)}function f(c){const t=new Date(c),a=new Date,s=t.getFullYear()===a.getFullYear()&&t.getMonth()===a.getMonth()&&t.getDate()===a.getDate(),n={month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0};return s?t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):t.toLocaleString("en-US",n)}function $(c,t,a){fetch(`/message/getMessages/${c}`,{method:"GET"}).then(async s=>{const n=await s.json();if(!n.success||!n.msgData){t([]);return}const d=n.msgData.find(o=>o.chat_id===a);t(d?d.messageData:[])}).catch(s=>{console.log(s),t([])})}function J(c,t,a,s){fetch("/message/sendMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:c,message:t,user_id:a})}).then(async n=>{const d=await n.json();console.log(d.message)}).catch(n=>{console.log(n)}),s(""),v(c,a)}function _(c,t,a,s){fetch("/message/deleteMessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message_id:c,user_id:t,sender_id:a,chat_id:s})}).then(async n=>{const d=await n.json();console.log(d.message)}).catch(n=>{console.log(n)})}function v(c,t){fetch("/message/readMessages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:c,user_id:t})}).then(async a=>{const s=await a.json();console.log(s.message)}).catch(a=>{console.log(a)})}const q="/assets/leaveChatIcon-VdSxEAUK.png",A="/assets/edit-chat-name-icon-DvX9AU5r.png",I="/assets/update-chat-name-icon-TTeh5gq5.png";function ae({currentUser:c,currentFriends:t,ifLightMode:a,allChats:s,setAllChats:n}){const[d,o]=g.useState(!1),[i,r]=g.useState(!1),[l,m]=g.useState("chats");return e.jsxs(e.Fragment,{children:[d?e.jsx(L,{currentFriends:t,currentUser:c,setCreateChatsDisplay:o,ifLightMode:a}):e.jsx(e.Fragment,{}),e.jsx(R,{setCreateChatsDisplay:o,addMembersDisplay:i,setAddMembersDisplay:r,currentUser:c,allChats:s,currentFriends:t,ifLightMode:a,mobileView:l,setMobileView:m})]})}function R({setCreateChatsDisplay:c,addMembersDisplay:t,setAddMembersDisplay:a,currentUser:s,allChats:n,currentFriends:d,ifLightMode:o,mobileView:i,setMobileView:r}){const[l,m]=g.useState(null),[u,j]=g.useState("");g.useEffect(()=>{if(!l)return;const h=n.find(k=>k.chat_id===l.chat_id);h?m(h):(m(null),r("chats"))},[n]),g.useEffect(()=>{l&&l.unread&&H(l.chat_id,s.id)},[l]);const p=h=>{m(h),r("messages")},x=[];for(const h of n.filter(k=>k.chat_name.toLowerCase().includes(u.toLowerCase()))||[]){const{chat_name:k}=h;x.push(e.jsxs("li",{onClick:()=>p(h),className:`chat ${l?.chat_id===h.chat_id?"selected-chat":""} ${o?"":"dark-mode"}`,children:[e.jsxs("p",{className:"chat-name-sec",children:[k," ",h.unread?"ðŸ”´ unread messages":""]}),e.jsxs("div",{className:"chat-button-container",children:[h.creator_id===s.id?e.jsx("button",{id:"delete-chat-btn",className:o?"":"dark-mode",onClick:N=>{N.stopPropagation(),Q(s.id,h.chat_id,h.creator_id),h.chat_id===l?.chat_id&&(m(null),r("chats")),a(!1)},children:"Delete"}):e.jsx(e.Fragment,{}),e.jsx("button",{id:"leave-btn",className:o?"":"dark-mode",onClick:N=>{N.stopPropagation(),W(s.id,s.username,h.chat_id,h.creator_id),console.log(h.chat_id+", "+l?.chat_id),h.chat_id===l?.chat_id&&(m(null),r("chats")),a(!1)},children:e.jsx("img",{alt:"Leave",className:"leave-chat-icon",src:q})})]})]},h.chat_id))}return e.jsx(e.Fragment,{children:e.jsxs("main",{id:"main-chat-page",className:`${o?"":"dark-mode"} mobile-view-${i}`,children:[l&&e.jsx("div",{className:`mobile-nav-arrows ${o?"":"dark-mode"}`,children:i==="messages"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`mobile-nav-arrow left ${o?"":"dark-mode"}`,onClick:()=>r("chats"),title:"Back to Chats",children:"â† Chats"}),e.jsx("span",{className:"mobile-chat-title",children:l.chat_name}),e.jsx("button",{className:`mobile-nav-arrow right ${o?"":"dark-mode"}`,onClick:()=>r("users"),title:"View Users",children:"Users â†’"})]}):i==="users"?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`mobile-nav-arrow left ${o?"":"dark-mode"}`,onClick:()=>r("messages"),title:"Back to Messages",children:"â† Messages"}),e.jsx("span",{className:"mobile-chat-title",children:l.chat_name})]}):e.jsx(e.Fragment,{})}),e.jsxs("div",{id:"chat-list-container",className:o?"":"dark-mode",children:[e.jsx("button",{id:"show-create-chat-popup",className:o?"":"dark-mode",onClick:()=>c(!0),children:"Create Chat"}),e.jsx("input",{type:"text",id:"search-chats-bar",className:o?"":"dark-mode",placeholder:"Search chats...",value:u,onChange:h=>{j(h.target.value)}}),e.jsx("ul",{id:"chat-list",children:x})]}),l?e.jsxs(e.Fragment,{children:[e.jsx(E,{chat_name:l.chat_name,chat_id:l.chat_id,currentUser:s,ifLightMode:o,selectedChat:l}),e.jsx(Y,{addMembersDisplay:t,setAddMembersDisplay:a,chat_id:l.chat_id,userList:l.userList,creator_id:l.creator_id,currentUser:s,currentFriends:d,ifLightMode:o})]}):e.jsx(e.Fragment,{})]})})}function E({chat_name:c,chat_id:t,currentUser:a,ifLightMode:s,selectedChat:n}){const[d,o]=g.useState(!1),[i,r]=g.useState(c);return e.jsxs("div",{id:"chat-layout",className:s?"":"dark-mode",children:[e.jsxs("p",{id:"chat-name",className:s?"":"dark-mode",children:[d?e.jsx("input",{className:s?"":"dark-mode",placeholder:"New chat name",id:"new-chat-name-input",type:"text",maxLength:30,value:i,onChange:l=>r(l.target.value)}):c,n.creator_id===a.id?d?e.jsx("button",{className:s?"":"dark-mode",id:"update-chat-name-btn",onClick:()=>B(o,i,t,a.id,n.creator_id,a.username),children:e.jsx("img",{src:I,id:"update-chat-icon",alt:"update"})}):e.jsx("button",{className:s?"":"dark-mode",id:"edit-chat-name-btn",onClick:()=>o(!d),children:e.jsx("img",{src:A,id:"edit-chat-icon",alt:"edit"})}):e.jsx(e.Fragment,{})]}),e.jsx(w,{currentUser:a,chat_id:t,ifLightMode:s})]})}function B(c,t,a,s,n,d){c(!1),fetch("/chats/editChatName",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({newChatName:t,chat_id:a,user_id:s,creator_id:n,username:d})}).then(async o=>{const i=await o.json();console.log(i.message)}).catch(o=>{console.log(o)})}function Y({addMembersDisplay:c,setAddMembersDisplay:t,chat_id:a,userList:s,creator_id:n,currentUser:d,currentFriends:o,ifLightMode:i}){const r=[],[l,m]=g.useState(null);for(const u of s){if(!u)continue;const{friend_id:j,user_id:p,status:x,username:h,joined_at:k,account_created:N,description:T,updated_at:O}=u;let y,C="";p!==d.id&&(x==="friends"?(y=" ðŸ‘¥",C="Friends"):x==="outgoing"?(y=e.jsx("button",{className:`cancel-req-btn ${i?"":"dark-mode"}`,onClick:()=>V(j??0,p,h??""),children:" Cancel "}),C=" Outgoing Request"):x==="incoming"?(y=e.jsxs("div",{className:"chat-incoming-req-btns",children:[e.jsx("button",{className:`reject-req-btn ${i?"":"dark-mode"}`,onClick:()=>U(j??0,h??"",p),children:" Reject "}),e.jsx("button",{className:`accept-req-btn ${i?"":"dark-mode"}`,onClick:()=>M(j??0,h??"",p),children:" Accept "})]}),C=" Incoming Request"):y=e.jsx("button",{className:`send-friend-req-btn ${i?"":"dark-mode"}`,onClick:()=>Z(d.id,p),children:"Send Request"})),r.push(e.jsxs("li",{className:`chat-user-list ${i?"":"dark-mode"}`,onClick:()=>m(p),children:[l===p?e.jsx(G,{user_id:p,username:h??"",description:T??"",account_created:b(N??""),joined_at:b(k),friendsBtns:y,updated_at:b(O??""),descFriends:C,setUserDetailsOpen:m,currentUser:d,ifLightMode:i}):e.jsx(e.Fragment,{}),`${n===p?"ðŸ‘‘":""}`,h,d.id===p?"(You)":"",e.jsx("p",{className:`desc-friends ${i?"":"dark-mode"}`,children:C}),n===d.id&&d.id!==p?e.jsx("button",{className:`kick-btn ${i?"":"dark-mode"}`,onClick:()=>z(n,d.id,d.username,p,h??"",a),children:"Kick"}):e.jsx(e.Fragment,{})]},`${a}-${u.username}`))}return e.jsxs("ul",{id:"chat-users-container",className:i?"":"dark-mode",children:[e.jsx("div",{id:"chat-users-header",className:i?"":"dark-mode",children:"Users in Chat:"}),r,e.jsx("button",{id:"add-members-btn",className:i?"":"dark-mode",onClick:()=>t(!0),children:"Add members"}),c?e.jsx(X,{setAddMembersDisplay:t,userList:s,currentFriends:o,chat_id:a,currentUser:d,ifLightMode:i}):e.jsx(e.Fragment,{})]})}function G({user_id:c,username:t,description:a,account_created:s,joined_at:n,friendsBtns:d,updated_at:o,descFriends:i,setUserDetailsOpen:r,currentUser:l,ifLightMode:m}){return e.jsxs("div",{id:"display-user-details",className:m?"":"dark-mode",children:[e.jsx("button",{id:"close-user-details",className:m?"":"dark-mode",onClick:u=>{u.stopPropagation(),r(null)},children:"X"}),e.jsxs("h3",{id:"display-user-username",className:m?"":"dark-mode",children:[e.jsx("b",{children:t})," ID: ",c," ",d]}),e.jsxs("p",{id:"creation-date",className:m?"":"dark-mode",children:["Account created at: ",s]}),e.jsxs("p",{id:"joined-date",className:m?"":"dark-mode",children:["Joined chat: ",n]}),l.id!==c?e.jsxs("p",{id:"friends-since",className:m?"":"dark-mode",children:[i," ",o?`Since ${o}`:""]}):e.jsx(e.Fragment,{}),e.jsxs("p",{id:"display-user-description",className:m?"":"dark-mode",children:["Description: ",a||"None added"]})]})}function X({setAddMembersDisplay:c,userList:t,currentFriends:a,chat_id:s,currentUser:n,ifLightMode:d}){const[o,i]=g.useState([]),r=a.filter(l=>!t.some(m=>m.user_id===l.user_id));return e.jsxs("div",{id:"add-friends-container",className:d?"":"dark-mode",children:[e.jsx("button",{id:"close-add-members-popup",className:d?"":"dark-mode",onClick:()=>c(!1),children:"X"}),e.jsx("h2",{className:d?"":"dark-mode",children:"Add Members"}),e.jsx("ul",{children:r.map(l=>{const m=o.some(u=>u.friend_id===l.friend_id);return e.jsx("li",{className:`add-members ${m?"selected":""} ${d?"":"dark-mode"}`,onClick:()=>{i(m?o.filter(u=>u.friend_id!==l.friend_id):[...o,l])},children:l.username},`add-members-${l.friend_id}`)})}),e.jsx("button",{id:"add-members-btn",className:d?"":"dark-mode",onClick:()=>K(n.username,n.id,o,s,c),children:"Add"})]})}function b(c){const t=new Date(c),a=new Date;t.getFullYear()===a.getFullYear()&&t.getMonth()===a.getMonth()&&(t.getDate(),a.getDate());const s={month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0};return t.toLocaleString("en-US",s)}function K(c,t,a,s,n){if(n(!1),a.length===0){console.log("No friends selected");return}fetch("/chats/addToChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:c,user_id:t,addedFriends:a,chat_id:s})}).then(async d=>{const o=await d.json();console.log(o.message)}).catch(d=>{console.log(d)})}function z(c,t,a,s,n,d){fetch("/chats/kick",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({creator_id:c,user_id:t,user_username:a,kicked_id:s,kicked_username:n,chat_id:d})}).then(async o=>{const i=await o.json();console.log(i.message)}).catch(o=>{console.log(o)})}function H(c,t){fetch("/message/readMessages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_id:c,user_id:t})}).then(async a=>{const s=await a.json();console.log(s.message)}).catch(a=>{console.log(a)})}function Q(c,t,a){fetch("/chats/deleteChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:c,chat_id:t,creator_id:a})}).then(async s=>{const n=await s.json();console.log(n.message)}).catch(s=>{console.log(s)})}function W(c,t,a,s){fetch("/chats/leaveChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:c,username:t,chat_id:a,creator_id:s})}).then(async n=>{const d=await n.json();console.log(d.message)}).catch(n=>{console.log(n)})}function Z(c,t){fetch("/friends/sendFriendRequest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sender_id:c,receiver_id:t})}).then(async a=>{const s=await a.json();console.log(s)}).catch(a=>{console.log(a)})}function V(c,t,a){fetch("/friends/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({friend_id:c,receiver_id:t,receiver_username:a})}).then(async s=>{const n=await s.json();console.log(n.message)}).catch(s=>{console.log(s)})}function U(c,t,a){fetch("/friends/reject",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({friend_id:c,sender_id:a,sender_username:t})}).then(async s=>{const n=await s.json();console.log(n.message)}).catch(s=>{console.log(s)})}function M(c,t,a){fetch("/friends/accept",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({friend_id:c,sender_id:a,sender_username:t})}).then(async s=>{const n=await s.json();console.log(n.message)}).catch(s=>{console.log(s)})}function L({currentFriends:c,currentUser:t,setCreateChatsDisplay:a,ifLightMode:s}){const[n,d]=g.useState([]),[o,i]=g.useState(""),[r,l]=g.useState(""),m=[];console.log(n);for(const u of c){const j=n.some(p=>p.friend_id===u.friend_id);m.push(e.jsx("li",{className:`create-chat-friends 
                ${j?"selected":""} ${s?"":"dark-mode"}`,onClick:()=>{if(j){const p=n.filter(x=>x.friend_id!==u.friend_id);d(p)}else d([...n,u])},children:u.username},`create-chats-popup-${u.friend_id}`))}return e.jsxs("div",{id:"create-chats-popup",className:s?"":"dark-mode",children:[e.jsx("button",{id:"close-create-chats-popup",className:s?"":"dark-mode",onClick:()=>a(!1),children:"X"}),e.jsx("h2",{className:s?"":"dark-mode",children:"Create Chat"}),e.jsx("ul",{children:m}),e.jsx("input",{placeholder:"Chat Name",id:"get-chat-name",className:s?"":"dark-mode",value:o,type:"text",maxLength:30,onChange:u=>i(u.target.value)}),e.jsx("button",{id:"create-chat-btn",className:s?"":"dark-mode",onClick:()=>ee(t.username,t.id,n,o,i,d,a,l),children:"Create Chat"}),e.jsx("p",{id:"popup-display-msg",className:s?"":"dark-mode",children:r})]})}function ee(c,t,a,s,n,d,o,i){fetch("/chats/createChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({creator_username:c,creator_id:t,addedFriends:a,chat_name:s})}).then(async r=>{const l=await r.json();console.log(l.message),l.success?o(!1):i(l.message)}).catch(r=>{console.log(r)}),n(""),d([])}export{ae as default};
